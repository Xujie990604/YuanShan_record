<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<title></title>
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/iconfont.css" rel="stylesheet" />
		<link href="../css/Common.css" rel="stylesheet" />
		<link href="../css/theme_normal.css" rel="stylesheet" />
		<style>
			.mui-table-view-cell .ui-tip {
				position: absolute;
				right: 0px;
				z-index: 100;
				width: 100% !important;
				background: transparent !important;
			}
			
			.noFileImg {
				position: absolute;
				top: 30%;
				width: 60%;
				left: 20%;
			}
			
			.noFileImg img {
				width: 100%;
			}
			
			.mui-checkbox input[type='checkbox']:before {
				content: '';
			}

      .select-model:not(.select-model:last-child) .mui-table-view-cell:last-child::after {
        height: 1px;
      }

      .select-model:last-child .mui-table-view-cell:last-child::after {
        height: 0;
      }

      /* 灵敏度选项的样式 */
      .sensitivity-content {
				position: relative;
				height: 60px;
			}

			#Sensitivity-item .mui-radio {
				position: absolute;
				top: 0;
				height: 100%;
				width: 16px;
				z-index: 2;
			}

			#Sensitivity-item .radio-low {
				left: 0;
			}

			#Sensitivity-item .radio-middle {
				left: 50%;
				margin-left: -8px;
			}

			#Sensitivity-item .radio-high {
				left: 100%;
				margin-left: -16px;
			}
			
			
			#Sensitivity-item .radio-input {
				position: absolute;
				top: 20px;
				left: 2px;
				width: 14px;
				height: 14px;
			}
			
			#Sensitivity-item .radio-input::before {
				display: block;
				position: absolute;
				font-size: 16px;
				top: -1px;
				left: -2px;
			}

      #Sensitivity-item .radio-text-content {
        position: absolute;
        top: 45px;
        width: 100%;
        height: 21px;
        z-index: 2;
      }

      #Sensitivity-item .radio-text-content .radio-text {
        width: 60px;
        font-size: 14px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      #Sensitivity-item .radio-text-content .radio-text:nth-of-type(1) {
        position: absolute;
        left: 0;
        text-align: left;
      }

      #Sensitivity-item .radio-text-content .radio-text:nth-of-type(2) {
        position: absolute;
        left: 50%;
        margin-left: -30px;
        text-align: center;
      }

      #Sensitivity-item .radio-text-content .radio-text:nth-of-type(3) {
        position: absolute;
        right: 0;
        text-align: right;
      }
			
			#Sensitivity-item .line {
				position: absolute;
				width: 96%;
				height: 4px;
				top: 44%;
				left: 2%;
				margin-top: -1px;
				background-color: rgb(51,51,51,0.08);
				z-index: 1;
			}

      .mui-table-view .sensitivity-item {
        height: 126px;
      }

      .mui-table-view .sensitivity-item.mui-active {
        background-color: #fff;
      }

      .mui-table-view .sensitivity-title-content {
        height: 26px;
      }

      .mui-table-view .sensitivity-title {
        height: 26px;
      }
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="back" class="mui-icon iconfont icon-back1"></a>
			<h1 id="title" class="mui-title" data-text="WEB_enterArea">&nbsp;</h1>
		</header>
		<div class="mui-content">
			<div id="EZView-content" class="mui-hidden">
				<!--进入区域-->
				<ul id="setAccessZoneCheck" class="mui-table-view ui-siwtchlist">
					<li id="setAccessZone" class="mui-table-view-cell">
						<span data-text="WEB_enterArea" class="mainStyle">&nbsp;</span>
						<div id="setAccessZoneSwitch" class="mui-switch mui-switch-mini">
							<div class="mui-switch-handle" id="setAccessZoneCircle"></div>
						</div>
						<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
					</li>
					<li id="AccessZoneCheckAreaItem" class="mui-table-view-cell mui-hidden">
						<a id="AccessZoneCheckArea">&nbsp;
							<span data-text="WEB_Draw_Area" class="mainStyle padding-left-15">&nbsp;</span>
							<span class="mui-badge" style="display: none; top: 27px;"><img src="../images/intrusion.png" alt="" /></span>
						</a>
						<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
					</li>
          <!-- 灵敏度设置 -->
          <li id="Sensitivity-item" class="mui-table-view-cell mui-hidden sensitivity-item">
            <!-- 灵敏度标题 -->
            <div class="sensitivity-title-content">
              <span data-text="WEB_Sensitivity" class="sensitivity-title-text padding-left-15">&nbsp;</span>
            </div>
            <!-- 灵敏度内容区 -->
            <div id="sensitivity-content" class="sensitivity-content" data-curValue="">
              <!-- 灵敏度 -  低 -->
              <div id="item-low" class="mui-input-row mui-radio mui-left radio-low">
                <input class="radio-input" name="radio1" type="radio" value="25">
              </div>
              <!-- 灵敏度 - 中 -->
              <div id="item-middle" class="mui-input-row mui-radio mui-left radio-middle">
                <input class="radio-input" name="radio1" type="radio" value="50">
              </div>
              <!-- 灵敏度 - 高 -->
              <div id="item-high" class="mui-input-row mui-radio mui-left radio-high">
                <input class="radio-input" name="radio1" type="radio" value="75">
              </div>
            <!-- 灵敏度档位文字 -->
            <div class="radio-text-content">
              <label class="radio-text" data-text="WEB_Low"></label>
              <label class="radio-text" data-text="WEB_Middle"></label>
              <label class="radio-text" data-text="WEB_High"></label>
            </div>
              <!-- 横线 -->
              <div class="line"></div>
            </div>
            <div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
          </li>


					<li id="AccessZoneCaptureTargetItem" class="mui-table-view-cell mui-hidden">
						<a href="#AccessZoneCaptureTarget" id="CrossLineCaptureTargetStep" class="mui-navigate-right">&nbsp;
							<span data-text="WEB_snapshotObject" class="mainStyle padding-left-15">&nbsp;</span>
							<span id="AccessZoneCaptureTargetItemStepVal" class="mui-badge">&nbsp;</span>
						</a>
						<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
					</li>
					<!--<li id="AccessZoneAlarmItem" class="mui-table-view-cell mui-hidden">
						<a id="AccessZoneAlarmStep" class="mui-navigate-right">&nbsp;
							<span data-text="WEB_Alarm_plan" class="mainStyle padding-left-15">&nbsp;</span>
							<span id="AccessZoneLightStepVal" class="mui-badge"></span>
						</a>
						<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
					</li>-->
					<li id="AudioAlarmTtem" class="mui-table-view-cell  mui-hidden">
						<a id="AudioAlarmStep">&nbsp;
							<span data-text="WEB_audio_alarm" class="mainStyle padding-left-15">&nbsp;</span>
							<div id="setAudioAlarmSwitch" class="mui-switch mui-switch-mini">
								<div class="mui-switch-handle" id="setAudioAlarmCircle"></div>
							</div>
						</a>
						<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
					</li>
					<div id="alarmModal" class="select-model">
						<li id="AudioAlarmModeItem" class="mui-table-view-cell mui-hidden">
							<a id="AudioAlarmModeStep" class="mui-navigate-right">&nbsp;
								<span data-text="WEB_linkageMode" class="mainStyle padding-left-30">&nbsp;</span>
								<span id="AudioAlarmModeStepVal" class="mui-badge"></span>
							</a>
							<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
						</li>
						<li id="selectAudioItem" class="mui-table-view-cell selectAudioStepli mui-hidden">
							<a id="selectAudioStep" class="mui-navigate-right">&nbsp;
								<span data-text="WEB_alarm_audio_selected" class="mainStyle padding-left-30">&nbsp;</span>
								<span id="selectAudioStepVal" class="mui-badge"></span>
							</a>
							<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
						</li>
					</div>
					<li id="LightAlarmTtem" class="mui-table-view-cell  mui-hidden">
						<a id="LightAlarmStep">&nbsp;
							<span data-text="WEB_light_alarm" class="mainStyle padding-left-15">&nbsp;</span>
							<div id="setLightAlarmSwitch" class="mui-switch mui-switch-mini">
								<div class="mui-switch-handle" id="setLightAlarmCircle"></div>
							</div>
						</a>
						<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
					</li>
					<div id="alarmLightModal" class="select-model">
						<li id="LightAlarmModeItem" class="mui-table-view-cell mui-hidden">
							<a id="LightAlarmModeStep" class="mui-navigate-right">&nbsp;
								<span data-text="WEB_linkageMode" class="mainStyle padding-left-30">&nbsp;</span>
								<span id="LightAlarmModeStepVal" class="mui-badge"></span>
							</a>
							<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
						</li>
					</div>
				</ul>
			</div>
		</div>
		<!--抓拍目标弹窗-->
		<div id="AccessZoneCaptureTarget" class="mui-popover mui-popover-action mui-popover-bottom ui-radio-list no-title-popover">
			<form id="CaptureTargetList" class="mui-input-group">
				<div class="mui-input-row mui-checkbox">
					<label data-text="WEB_motorVehicle">&nbsp;</label>
					<input name="n1" class="checked" value=0 type="checkbox">
				</div>
				<div class="mui-input-row mui-checkbox">
					<label data-text="WEB_nonMotorVehicle">&nbsp;</label>
					<input name="n2" class="checked" value=1 type="checkbox">
				</div>
				<div class="mui-input-row mui-checkbox">
					<label data-text="WEB_pedestrian">&nbsp;</label>
					<input name="n3" class="checked" value=2 type="checkbox">
				</div>
			</form>
			<button id="AccessZoneCaptureTargetOk" class="mui-btn mui-btn-block ui-dateok" data-text="WEB_button_ok">&nbsp;</button>
		</div>
		<div id="selectAudio" class="mui-popover mui-popover-action mui-popover-bottom ui-radio-list">
			<form class="mui-input-group">
				<div class="mui-input-row mui-checkbox ui-list-titile">
					<label data-text="WEB_alarm_audio_selected">&nbsp;</label>
					<span id="closeAudioList" class="mui-icon mui-icon-closeempty"></span>
				</div>
				<div id="selectAudioListItem" class="ui-list-container">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul id="selectAudioList" class="mui-table-view mui-table-view-radio">
							</ul>
						</div>
					</div>
				</div>
			</form>
			<button id="selectAudioListOk" class="mui-btn mui-btn-block ui-dateok" data-text="WEB_button_ok">&nbsp;</button>
		</div>
		<script src="../js/dsbridge.min.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/libs/md5.js"></script>
		<script src="../js/libs/jquery-3.4.1.min.js"></script>
		<script src="../js/libs/sha2.js"></script>
		<script src="../js/resource.js"></script>
		<script src="../js/Utils.js"></script>
		<script src="../js/mui.js"></script>
		<script src="../js/immersed.js"></script>
		<script src="../js/customSetting.js"></script>
		<script src="../js/loadCss.js "></script>
    <script id="langScript"></script>
		<script>
			var langTip;
			checkType(localStorage.AppType); //加载特定样式
			var AccessZoneGridService = {};
			var setAccessZoneConfirm = true; //进入区域开关状态变化时是否调接口提交
			var AccessZoneServiceData; //进入区域使能服务端数据
			var AccessZoneCheck; // 进入区域开关是否开启
			var AccessZoneSensitivityVal; //灵敏度取值
			var AccessZoneSensitivityChecked; //灵敏度列表选中项
			var CTargetList; //选中目标
			var CrossLineTargetCheckList; //目标列表选中项
			var DetectTargetInfo = {
				Enabled: 0,
				Type: "",
				ObjectMaxSize: {
					Width: 9999,
					Height: 9999
				},
				ObjectMinSize: {
					Width: 105,
					Height: 186
				}
			};
			var RectangleAreaNum; //可绘制区域数
			var CrossLineNum; //可绘制线条数
			var SupportDayNightCfg; //是否支持日夜模式
			var AccessZoneCheckTimeServiceData; //进入区域检测时间服务端数据
			var CheckTimeStepChecked = ''; //检测时间初始值“全天”“自定义”
			var AudioTimeSectionInfo = {
				Enabled: 0,
				Begin: "00:00:00",
				End: "00:00:00",
				AudioActParamInfo: {
					AudioFileID: 0,
					WarnCount: 3,
					AudioVolume: 255
				}
			};
			var LightTimeSectionInfo = {
				Enabled: 0,
				Begin: "00:00:00",
				End: "00:00:00"
			};
			var Day = {
				ID: -1,
				Num: 0,
				TimeSectionInfos: []
			};
			var configData = {
				Num: 2,
				Actions: [{
					Enabled: 1,
					ActID: 28,
					ActParam: {
						TimeMode: 0,
						AudioCustomInfo: {
							Num: 7,
							Days: []
						},
						AudioDayNightInfo: {
							Num: 7,
							Days: []
						}
					}
				}, {
					Enabled: 1,
					ActID: 29,
					ActParam: {
						TimeMode: 1,
						LightCustomInfo: {
							LightActParamInfo: {
								Interval: 10,
								Luminance: 50
							},
							LightWeekPlanInfo: {
								Num: 7,
								Days: []
							}
						},
						LightDayNightInfo: {
							LightActParamInfo: {
								Interval: 10,
								Luminance: 50
							},
							LightDayNightPlanInfo: {
								Num: 7,
								Days: []
							}
						}
					}
				}]
			};

			var audioDayNight = {
				AudioDayInfo: {
					AudioActParamInfo: {
						AudioFileID: 0,
						WarnCount: 3,
						AudioVolume: 255
					},
					Enabled: 0
				},
				AudioNightInfo: {
					AudioActParamInfo: {
						AudioFileID: 0,
						WarnCount: 3,
						AudioVolume: 255
					},
					Enabled: 0
				},
				ID: -1
			};

			var lightDayNight = {
				LightDayInfo: {
					Enabled: 0
				},
				LightNightInfo: {
					Enabled: 0
				},
				ID: -1
			};
			var saveData;
			var devOrgData;
			var devAudioInfo;
			var devLightInfo;
			var SupportLinkageDayNightMode = 0; //支持日夜模式
			var audioName;
			var setAudioAlarmConfirm = true; //声音开关状态变化时是否调接口提交
			var setLightAlarmConfirm = true; //灯光开关状态变化时是否调接口提交
			var AlarmLAPI;
			var AudioFile;
			var AudioAlarmCheck; // 声音开关是否开启
			var LightAlarmCheck; // 灯光开关是否开启
			var AudioCustomCheckedarr = []; //报警音选择列表名称
			var AudioDayNightCheckedarr = []; //日夜模式报警音选择列表名称
			var saveOrg;
			var supportAudioAlarm = true;
			var supportLightAlarm = true;
			var supportTarget = true;
			var AlarmAudioList;
			mui.init();
			var typeLan = initLang();
			langTip = typeLan.lang;
			initData();
			initEvent();


			function initData() {
				//初始化进入区域
				initAccessZone();
			}

			function initEvent() {

        // 灵敏度单选框
        $('#sensitivity-content input[name="radio1"]').each(function (index, el) {
          el.addEventListener('change', handlerChangeRadio)
        })

        // 灵敏度单选框 change 事件处理函数
        function handlerChangeRadio() {
          // 本次 change 之前被选中的值
          var curCheckedRadioValue = $('#sensitivity-content').attr('data-curValue');
          // 本次 change 之后的目标值
          var curChangeRadioValue = $(this).val();

          var sendData = deepCopy(AccessZoneGridService);
          sendData.PolygonInfoList[0].Sensitivity = Number(curChangeRadioValue);
          dsBridgeFuncSyn.showLoading();
          SendAjax(LAPI.AccessZoneAreas, 'put', function (code, data) {
            dsBridgeFuncSyn.dismiss();
            if (code == 0) {
              AccessZoneGridService = deepCopy(sendData);
              // 将当前选中的值存储到 data-curValue 属性中
              $('#sensitivity-content').attr('data-curValue', curChangeRadioValue);
              showToast(langTip["WEB_android_35"]);
            } else {
              // 接口请求失败，将单选框的选中状态还原
              $('#sensitivity-content input[name="radio1"]').each(function (index, El) {
                if (El.value == curCheckedRadioValue) {
                  El.checked = true;
                } else {
                  El.checked = false;
                }
              })
              showToast(langTip["WEB_toast_modify_favoritesname_failed"] + "(" + code + ")", code);
            }
          }, sendData);
        }

				/*进入区域 区域绘制*/
				document.getElementById('AccessZoneCheckArea').addEventListener('tap', AccessZoneCheckArea);
				if(supportTarget) {
					document.getElementById('AccessZoneCaptureTargetItem').addEventListener('tap', function() {
						mui('#CaptureTargetList input').each(function(index, El) {
							El.checked = false;
						});
						for(var i = 0; i < CTargetList.length; i++) {
							mui('#CaptureTargetList input').each(function(index, El) {
								if(CTargetList[i].Enabled == 1 && CTargetList[i].Type == Number(El.value)) {
									El.checked = true;
									return;
								}
							});
						}
						setTarget();
					});
				}

				document.getElementById('AccessZoneCaptureTargetOk').addEventListener('tap', AccessZoneCaptureTargetOk);
				document.getElementById('selectAudioListOk').addEventListener('tap', selectAudioListOk); //报警音确定
				document.querySelectorAll(".selectAudioStepli a").forEach(function(v) { // 报警音弹框选择
					v.addEventListener('tap', function(event) {
						var textAudio = $("#selectAudioStepVal").text().trim();
						audioCurNode = $(v);
						mui('#selectAudio').popover('toggle');

						mui('#selectAudioList a').each(function(index, El) {
							El.parentNode.classList.remove('mui-selected');
							if(El.innerText.trim() == textAudio) {
								El.parentNode.classList.add('mui-selected');
							}
						});
					})
				});
				if(supportAudioAlarm) {
					document.getElementById("AudioAlarmModeItem").addEventListener("tap", function() {
						var Extras = {
							AlarmType: 3,
							SupportLinkageDayNightMode: SupportLinkageDayNightMode,
							saveData: saveData,
							devOrgData: devOrgData,
							configData: configData,
							AlarmLAPI: AlarmLAPI,
							ActID: 0,
							supportAudioAlarm: supportAudioAlarm,
							supportLightAlarm: supportLightAlarm
						}
						jumpToWebPage("settings_DeepAlarmRe", JSON.stringify(Extras));
					});
					initAudioAlarmSwtich();
				}
				if(supportLightAlarm) {
					document.getElementById("LightAlarmModeItem").addEventListener("tap", function() {
						var Extras = {
							AlarmType: 3,
							SupportLinkageDayNightMode: SupportLinkageDayNightMode,
							saveData: saveData,
							devOrgData: devOrgData,
							configData: configData,
							AlarmLAPI: AlarmLAPI,
							ActID: 1,
							supportAudioAlarm: supportAudioAlarm,
							supportLightAlarm: supportLightAlarm
						}
						jumpToWebPage("settings_DeepAlarmRe", JSON.stringify(Extras));
					});
					initLightAlarmSwtich();
				}

			}

			/******************************************进入区域-使能********************************************/
			/*
			 * 初始化  进入区域使能
			 */
			function initAccessZone() {
				var Url = "web/newPages/settings_AccessZone.html";
				var self = dsBridgeFuncSyn.getWebParam(Url);
				self = JSON.parse(self);
				var data = self.capacityData;
				if(!(data.AccessZone.Mode && data.AccessZone.Mode == 1)) {
					$("#AccessZoneCaptureTargetItem").remove();
					supportTarget = false;
				}
				if(!(data.AccessZone.LinkagePlanCfg && data.AccessZone.LinkagePlanCfg.SupportAudioLinkagePlan == 1)) {
					$("#AudioAlarmTtem").remove();
					$("#alarmModal").remove();
					supportAudioAlarm = false;
				}
				if(!(data.AccessZone.LinkagePlanCfg && data.AccessZone.LinkagePlanCfg.SupportLightLinkagePlan == 1)) {
					$("#LightAlarmTtem").remove();
					$("#alarmLightModal").remove();
					supportLightAlarm = false;
				}
				initAccessZoneData();
			}

			/**
			 * 初始化 进入区域使能数据
			 * @param {Object} 
			 */
			function initAccessZoneData() {
				SendAjax(LAPI.AccessZoneRule, 'get', function(code, data) {
					if(code == 0) {
						$("#EZView-content").removeClass("mui-hidden");
						AccessZoneServiceData = deepCopy(data);
						AccessZoneCheck = data.Enabled; // 0：关闭，1：开启
						if(AccessZoneCheck == 1 && localStorage.dvt != 100) {
							mui("#setAccessZoneCheck .mui-table-view-cell").each(function(index, El) {
								if(index != 0) {
									El.classList.remove('mui-hidden');
								}
							});
						}
						//隐藏联动模式/自定义报警
						$("#alarmModal").addClass("mui-hidden");
						$("#alarmLightModal").addClass("mui-hidden");
						//初始化进入区域开关
						document.getElementById("setAccessZoneSwitch").style.zIndex = 20;
						document.getElementById("setAccessZoneSwitch").style.visibility = "visible";
						setAccessZoneConfirm = false;
						setSwitchStatus("setAccessZoneSwitch", AccessZoneCheck);
						setAccessZoneConfirm = true;
						var setAccessZoneActive = document.getElementById("setAccessZoneSwitch").classList.contains("mui-active");
						if(setAccessZoneActive) {
							document.getElementById("setAccessZoneCircle").style.transform = 'translate(16px, 0px)';
						}
						if(localStorage.dvt != 100) {
							initAccessZoneAreas();
						} else {
							dsBridgeFuncSyn.dismiss();
						}
					} else {
						//数据获取失败的处理
						addBitmap(0);
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				});
			}
			/*
			 * 监听进入区域检测开关
			 */
			document.getElementById("setAccessZoneSwitch").addEventListener("toggle", function(event) {
				if(event.detail.isActive && setAccessZoneConfirm) {
					var sendDataON = deepCopy(AccessZoneServiceData);
					sendDataON.Enabled = 1; // 0：进入区域关闭，1：进入区域开启
					dsBridgeFuncSyn.showLoading();
					SendAjax(LAPI.AccessZoneRule, 'put', function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {
							if(localStorage.dvt != 100) {
								mui("#setAccessZoneCheck .mui-table-view-cell").each(function(index, El) {
									if(index != 0) {
										El.classList.remove('mui-hidden');
									}
								});
							}
							showToast(langTip["WEB_api_error_succeeded"]);
						} else {
							setAccessZoneConfirm = false;
							showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
							setTimeout(function() {
								mui("#setAccessZoneSwitch").switch().toggle();
							}, 200);
						}
					}, sendDataON);
				} else if(!event.detail.isActive && setAccessZoneConfirm) {
					if(localStorage.dvt != 100) {
						mui("#setAccessZoneCheck .mui-table-view-cell").each(function(index, El) {
							if(index != 0) {
								El.classList.add('mui-hidden');
							}
						});
					}
					var sendDataOFF = deepCopy(AccessZoneServiceData);
					sendDataOFF.Enabled = 0; // 0：进入区域关闭，1：进入区域开启
					dsBridgeFuncSyn.showLoading();
					SendAjax(LAPI.AccessZoneRule, 'put', function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {
							showToast(langTip["WEB_api_error_succeeded"]);
						} else {
							setAccessZoneConfirm = false;
							showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
							setTimeout(function() {
								mui("#setAccessZoneSwitch").switch().toggle();
								if(localStorage.dvt != 100) {
									mui("#setAccessZoneCheck .mui-table-view-cell").each(function(index, El) {
										if(index != 0) {
											El.classList.remove('mui-hidden');
										}
									});
								}
							}, 300);
						}
					}, sendDataOFF);
				} else {
					setAccessZoneConfirm = true;
				};
			});

			/*****************************************进入区域-区域绘制+灵敏度***************************************/
			/**
			 * 初始化 进入区域区域绘制+灵敏度数据
			 */
			function initAccessZoneAreas() {
				SendAjax(LAPI.AccessZoneAreas, 'get', function(code, data) {
					if(code == 0) {
						document.getElementById("AccessZoneCheckArea").classList.add("mui-navigate-right");
						document.getElementById("AccessZoneCheckArea").children[1].style.display = "block";
						AccessZoneGridService = deepCopy(data);
						AccessZoneSensitivityVal = data.PolygonInfoList[0].Sensitivity;


            // 将接口中的灵敏度数值，转换为三个档位
            var gearAccessZoneSensitivityVal = SensitivityValue(AccessZoneSensitivityVal);
            // 根据接口中的灵敏度数值，初始化界面显示
            $('#sensitivity-content input[name="radio1"]').each(function (index, el) {
              if (el.value == gearAccessZoneSensitivityVal) {
                el.checked = true;
              }
            });
            // 在单选框的父元素上，添加 data-value 属性，用于记录当前选中的灵敏度
            $('#sensitivity-content').attr('data-curValue', gearAccessZoneSensitivityVal)

						if(data.PolygonInfoList[0].DetectTargetList && supportTarget) {
							if(data.PolygonInfoList[0].Num > 0) {
								CTargetList = JSON.parse(JSON.stringify(data.PolygonInfoList[0].DetectTargetList));
								for(var i = 0; i < CTargetList.length; i++) {
									mui('#CaptureTargetList input').each(function(index, El) {
										if(CTargetList[i].Enabled == 1 && CTargetList[i].Type == El.value) {
											El.checked = true;
										}
									});
								}
								setTarget();
							}
						}
						if(supportAudioAlarm || supportLightAlarm) {
							getDaycap();
						} else {
							dsBridgeFuncSyn.dismiss();
						}
					} else {
						dsBridgeFuncSyn.dismiss();
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						$("#AccessZoneCheckAreaItem div.loadFailed").removeClass("mui-hidden");
						$("#Sensitivity-item div.loadFailed").removeClass("mui-hidden");
					}
				});
			}
			/**
			 * 跳转至进入进入区域绘制
			 */
			function AccessZoneCheckArea() {
				var Extras = {
					AreaType: 1,
					ZoneGridService: AccessZoneGridService
				}
				jumpToWebPage("settings_ZoneArea", JSON.stringify(Extras), 1);
			}
			/**
			 * 抓拍目标确认事件
			 */
			function AccessZoneCaptureTargetOk() {
				var sendData = deepCopy(AccessZoneGridService);
				var TargetList = [];
				mui('#CaptureTargetList input').each(function(index, El) {
					var DetectTargetInitInfo = deepCopy(DetectTargetInfo);
					if(El.checked) {
						var flag = false;
						if(AccessZoneGridService.PolygonInfoList[0].Num > 0) {
							for(var i = 0; i < CTargetList.length; i++) {
								if(CTargetList[i].Type == Number(El.value)) {
									var item = deepCopy(CTargetList[i]);
									item.Enabled = 1;
									TargetList.push(item);
									flag = true;
								}
							}
						}
						if(!flag) {
							DetectTargetInitInfo.Enabled = 1;
							DetectTargetInitInfo.Type = Number(El.value);
							TargetList.push(DetectTargetInitInfo);
							sendData.PolygonInfoList[0].Num++;
						}
					} else {
						if(AccessZoneGridService.PolygonInfoList[0].Num > 0) {
							for(var i = 0; i < CTargetList.length; i++) {
								if(CTargetList[i].Type == El.value) {
									var item = deepCopy(CTargetList[i]);
									item.Enabled = 0;
									TargetList.push(item);
								}
							}
						}

					}
				});
				sendData.PolygonInfoList[0].DetectTargetList = TargetList;
				dsBridgeFuncSyn.showLoading();
				SendAjax(LAPI.AccessZoneAreas, 'put', function(code, data) {
					dsBridgeFuncSyn.dismiss();
					if(code == 0) {
						AccessZoneGridService = deepCopy(sendData);
						CTargetList = JSON.parse(JSON.stringify(TargetList));
						setTarget();
					} else {
						for(var i = 0; i < CTargetList.length; i++) {
							mui('#CaptureTargetList input').each(function(index, El) {
								if(CTargetList[i].Enabled == 1 && CTargetList[i].Type == El.value) {
									El.checked = true;
								} else if(CTargetList[i].Enabled == 0 && CTargetList[i].Type == El.value) {
									El.checked = false;
								}
							});
						}
						showToast(langTip["toast_modify_favoritesname_failed"] + "(" + code + ")", code);
						setTarget();
					}
					mui('#AccessZoneCaptureTarget').popover('toggle');
				}, sendData);
			}

			/**********************************************进入区域-报警布防**********************************************/
			/**
			 * 跳转至进入区域 报警布防页面
			 */
			function AccessZoneAlarmItem() {
				// TODO:页面跳转+传参
				var Extras = {
					AlarmType: 3
				}
				jumpToWebPage("settings_DeepAlarm", JSON.stringify(Extras));
			}

			/*
			 * 通道保存报警联动计划
			 */
			function savachl() {
				dsBridgeFuncSyn.showLoading();
				var sendData = getDevSendData();
				SendAjax(AlarmLAPI, 'put', function(code, data) {
					dsBridgeFuncSyn.dismiss();
					if(code == 0) {
						$("#selectAudioStepVal").text(audioName.trim());
						mui('#selectAudio').popover('toggle');
						showToast(langTip["WEB_api_error_succeeded"], code);
					} else {
						configData = JSON.parse(JSON.stringify(saveOrg));
						showToast(langTip["WEB_api_error_operation_fails"], code);
					}
				}, sendData);

			}

			/*
			 * 保存IPC告警音配置
			 */
			function save() {
				dsBridgeFuncSyn.showLoading();
				var sendData = getDevSendData();
				SendAjax(AlarmLAPI, 'put', function(code, data) {
					dsBridgeFuncSyn.dismiss();
					if(code == 0) {
						$("#selectAudioStepVal").text(audioName.trim());
						mui('#selectAudio').popover('toggle');
						showToast(langTip["WEB_api_error_succeeded"], code);
					} else {
						configData = JSON.parse(JSON.stringify(saveOrg));
						showToast(langTip["WEB_api_error_operation_fails"], code);
					}
				}, sendData);
			}

			function initAudioAlarmSwtich() {
				/*
				 * 监听声音检测开关
				 */
				document.getElementById("setAudioAlarmSwitch").addEventListener("toggle", function(event) {
					if(event.detail.isActive && setAudioAlarmConfirm) {
						var sendDataON = getDevSendData();
						for(var i = 0; i < sendDataON.Actions.length; i++) {
							if(sendDataON.Actions[i].ActID == 28) {
								sendDataON.Actions[i].Enabled = 1;
							}
						}
						dsBridgeFuncSyn.showLoading();
						SendAjax(AlarmLAPI, 'put', function(code, data) {
							dsBridgeFuncSyn.dismiss();
							if(code == 0) {
								//TODO:
								configData.Actions[0].Enabled = 1;
								$("#alarmModal").removeClass("mui-hidden");
								showToast(langTip["WEB_api_error_succeeded"]);
							} else {
								setAudioAlarmConfirm = false;
								showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
								setTimeout(function() {
									mui("#setAudioAlarmSwitch").switch().toggle();
								}, 200);
							}
						}, sendDataON);
					} else if(!event.detail.isActive && setAudioAlarmConfirm) {
						//TODO:
						$("#alarmModal").addClass("mui-hidden");
						var sendDataOFF = getDevSendData();
						for(var i = 0; i < sendDataOFF.Actions.length; i++) {
							if(sendDataOFF.Actions[i].ActID == 28) {
								sendDataOFF.Actions[i].Enabled = 0;
							}
						}
						dsBridgeFuncSyn.showLoading();
						SendAjax(AlarmLAPI, 'put', function(code, data) {
							dsBridgeFuncSyn.dismiss();
							if(code == 0) {
								configData.Actions[0].Enabled = 0;
								showToast(langTip["WEB_api_error_succeeded"]);
							} else {
								setAudioAlarmConfirm = false;
								showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
								setTimeout(function() {
									mui("#setAudioAlarmSwitch").switch().toggle();
									$("#alarmModal").removeClass("mui-hidden");
								}, 300);
							}
						}, sendDataOFF);
					} else {
						setAudioAlarmConfirm = true;
					};
				});
			}

			function initLightAlarmSwtich() {
				/*
				 * 监听灯光检测开关
				 */
				document.getElementById("setLightAlarmSwitch").addEventListener("toggle", function(event) {
					if(event.detail.isActive && setLightAlarmConfirm) {
						var sendDataON = getDevSendData();
						for(var i = 0; i < sendDataON.Actions.length; i++) {
							if(sendDataON.Actions[i].ActID == 29) {
								sendDataON.Actions[i].Enabled = 1;
							}
						}

						dsBridgeFuncSyn.showLoading();
						SendAjax(AlarmLAPI, 'put', function(code, data) {
							dsBridgeFuncSyn.dismiss();
							if(code == 0) {
								configData.Actions[1].Enabled = 1;
								$("#alarmLightModal").removeClass("mui-hidden");
								showToast(langTip["WEB_api_error_succeeded"]);
							} else {
								setLightAlarmConfirm = false;
								showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
								setTimeout(function() {
									mui("#setLightAlarmSwitch").switch().toggle();
								}, 200);
							}
						}, sendDataON);
					} else if(!event.detail.isActive && setLightAlarmConfirm) {
						$("#alarmLightModal").addClass("mui-hidden");
						var sendDataOFF = getDevSendData();
						for(var i = 0; i < sendDataOFF.Actions.length; i++) {
							if(sendDataOFF.Actions[i].ActID == 29) {
								sendDataOFF.Actions[i].Enabled = 0;
							}
						}
						dsBridgeFuncSyn.showLoading();
						SendAjax(AlarmLAPI, 'put', function(code, data) {
							dsBridgeFuncSyn.dismiss();
							if(code == 0) {
								configData.Actions[1].Enabled = 0;
								showToast(langTip["WEB_api_error_succeeded"]);
							} else {
								setLightAlarmConfirm = false;
								showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
								setTimeout(function() {
									mui("#setLightAlarmSwitch").switch().toggle();
									$("#alarmLightModal").removeClass("mui-hidden");
								}, 300);
							}
						}, sendDataOFF);
					} else {
						setLightAlarmConfirm = true;
					};
				});
			}

			function getDaycap() {
				SendAjax(LAPI.IPCorChannelCapabilities, 'get', function(code, data) {
					if(code == 0) {
						if(data.SupportLinkageDayNightMode && data.SupportLinkageDayNightMode == 1) {
							SupportLinkageDayNightMode = data.SupportLinkageDayNightMode;
						}
						getAlarmModeData();
					} else {
						$("#EZView-content").addClass("mui-hidden");
						addBitmap(0);
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				});
			}

			function getAlarmModeData() {
				AlarmLAPI = LAPI.AccessZoneLinkageActions;
				if(localStorage.deviceType == "0" && localStorage.isMultiChannelIPC == "0") {
					AudioFile = LAPI.AudioFile.replace("<ID>", -1);
				} else {
					AudioFile = LAPI.AudioFile;
				}

				SendAjax(AlarmLAPI, 'get', function(code, data) {
					if(code == 0) {
						saveData = JSON.parse(JSON.stringify(data));
						devOrgData = JSON.parse(JSON.stringify(data));
						//初始化声音报警状态，声音报警开关、联动模式、报警音选择
						if(supportAudioAlarm) {
							initAlarmAudio();
						} else {
							initAlarmStatus();
							initPlanCheckSwitch();
							initAudioAlarmData();
							initLightAlarmData();
							mui('.mui-scroll-wrapper').scroll();
							dsBridgeFuncSyn.dismiss();
						}
					} else {
						$("#EZView-content").addClass("mui-hidden");
						addBitmap(0);
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				});

			}

			/*
			 * 初始化按钮开关
			 */
			function initPlanCheckSwitch() {
				var AudioFirst = true;
				var LightFirst = true;
				var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
				var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
				var AudioInfoDayNight = configData.Actions[0].ActParam.AudioDayNightInfo;
				var LightInfoDayNight = configData.Actions[1].ActParam.LightDayNightInfo.LightDayNightPlanInfo;
				for(var z = 1; z < 8; z++) {
					var DayData1 = JSON.parse(JSON.stringify(Day));
					DayData1.ID = z;
					var DayData2 = JSON.parse(JSON.stringify(Day));
					DayData2.ID = z;
					var DayData3 = JSON.parse(JSON.stringify(audioDayNight));
					DayData3.ID = z;
					var DayData4 = JSON.parse(JSON.stringify(lightDayNight));
					DayData4.ID = z;
					for(var m = 0; m < 3; m++) {
						var TimeSectionInfosData1 = JSON.parse(JSON.stringify(AudioTimeSectionInfo));
						var TimeSectionInfosData2 = JSON.parse(JSON.stringify(LightTimeSectionInfo));
						DayData1.Num++;
						DayData2.Num++;
						DayData1.TimeSectionInfos.push(TimeSectionInfosData1);
						DayData2.TimeSectionInfos.push(TimeSectionInfosData2);
					}
					AudioInfo.Days.push(DayData1);
					LightInfo.LightWeekPlanInfo.Days.push(DayData2);
					AudioInfoDayNight.Days.push(DayData3);
					LightInfoDayNight.Days.push(DayData4);
				}
				initDefaulttime();
			}

			function initDefaulttime() {
				for(var j = 0; j < 7; j++) {
					if(supportAudioAlarm) {
						if(devAudioInfo && devAudioInfo.AudioDayNightInfo && devAudioInfo.AudioDayNightInfo.Num > 0) {
							var stasu1 = devAudioInfo.AudioDayNightInfo.Days[0].AudioDayInfo;
							configData.Actions[0].ActParam.AudioDayNightInfo.Days[j].AudioDayInfo = stasu1;
							var stasu2 = devAudioInfo.AudioDayNightInfo.Days[0].AudioNightInfo;
							configData.Actions[0].ActParam.AudioDayNightInfo.Days[j].AudioNightInfo = stasu2;
						}
					}
					if(supportLightAlarm) {
						if(devLightInfo && devLightInfo.LightDayNightInfo && devLightInfo.LightDayNightInfo.LightDayNightPlanInfo.Num > 0) {
							var stasu3 = devLightInfo.LightDayNightInfo.LightDayNightPlanInfo.Days[0].LightDayInfo;
							configData.Actions[1].ActParam.LightDayNightInfo.LightDayNightPlanInfo.Days[j].LightDayInfo = stasu3;
							var stasu4 = devLightInfo.LightDayNightInfo.LightDayNightPlanInfo.Days[0].LightNightInfo;
							configData.Actions[1].ActParam.LightDayNightInfo.LightDayNightPlanInfo.Days[j].LightNightInfo = stasu4;
						}
					}

				}
				if(supportAudioAlarm) {
					if(devAudioInfo.AudioCustomInfo.Num > 0 && devAudioInfo.AudioCustomInfo.Days[0].Num > 0) {
						for(var j = 0; j < 7; j++) {
							var max = devAudioInfo.AudioCustomInfo.Days[0].Num >= 3 ? 3 : devAudioInfo.AudioCustomInfo.Days[0].Num;
							for(var m = 0; m < max; m++) {
								var stasus = devAudioInfo.AudioCustomInfo.Days[0].TimeSectionInfos[m];
								configData.Actions[0].ActParam.AudioCustomInfo.Days[j].TimeSectionInfos[m] = stasus;
							}
						}
					}
				}
				if(supportLightAlarm) {
					if(devLightInfo.LightCustomInfo.LightWeekPlanInfo.Num > 0 && devLightInfo.LightCustomInfo.LightWeekPlanInfo.Days[0].Num > 0) {
						for(var j = 0; j < 7; j++) {
							var max = devLightInfo.LightCustomInfo.LightWeekPlanInfo.Days[0].Num >= 3 ? 3 : devLightInfo.LightCustomInfo.LightWeekPlanInfo.Days[0].Num;
							for(var m = 0; m < max; m++) {
								var stasus = devLightInfo.LightCustomInfo.LightWeekPlanInfo.Days[0].TimeSectionInfos[m];
								configData.Actions[1].ActParam.LightCustomInfo.LightWeekPlanInfo.Days[j].TimeSectionInfos[m] = stasus;
							}
						}
					}
				}
			}

			function initAlarmStatus() {
				for(var i = 0; i < saveData.Actions.length; i++) {
					if(saveData.Actions[i].ActID == 28 && supportAudioAlarm) {
						AudioAlarmCheck = saveData.Actions[i].Enabled;
						document.getElementById("setAudioAlarmSwitch").style.zIndex = 20;
						document.getElementById("setAudioAlarmSwitch").style.visibility = "visible";

						setAudioAlarmConfirm = false;
						setSwitchStatus("setAudioAlarmSwitch", AudioAlarmCheck);
						setAudioAlarmConfirm = true;
						var setAudioAlarmSwitch = document.getElementById("setAudioAlarmSwitch").classList.contains("mui-active");
						if(setAudioAlarmSwitch) {
							document.getElementById("setAudioAlarmCircle").style.transform = 'translate(16px, 0px)';
						}
						devAudioInfo = JSON.parse(JSON.stringify(saveData.Actions[i].ActParam));
						configData.Actions[0].ActParam.TimeMode = Number(JSON.parse(JSON.stringify(devAudioInfo.TimeMode)));
						configData.Actions[0].Enabled = AudioAlarmCheck;
						if(AudioAlarmCheck == 1) {
							$("#alarmModal").removeClass("mui-hidden");
						}
					}
				}
				for(var i = 0; i < saveData.Actions.length; i++) {
					if(saveData.Actions[i].ActID == 29 && supportLightAlarm) {
						LightAlarmCheck = saveData.Actions[i].Enabled;
						document.getElementById("setLightAlarmSwitch").style.zIndex = 20;
						document.getElementById("setLightAlarmSwitch").style.visibility = "visible";

						setLightAlarmConfirm = false;
						setSwitchStatus("setLightAlarmSwitch", LightAlarmCheck);
						setLightAlarmConfirm = true;
						var setLightAlarmSwitch = document.getElementById("setLightAlarmSwitch").classList.contains("mui-active");
						if(setLightAlarmSwitch) {
							document.getElementById("setLightAlarmCircle").style.transform = 'translate(16px, 0px)';
						}
						devLightInfo = JSON.parse(JSON.stringify(saveData.Actions[i].ActParam));
						configData.Actions[1].ActParam.TimeMode = Number(JSON.parse(JSON.stringify(devLightInfo.TimeMode)));
						configData.Actions[1].Enabled = LightAlarmCheck;
						if(LightAlarmCheck == 1) {
							$("#alarmLightModal").removeClass("mui-hidden");
						}
					}
				}
			}

			function initAudioAlarmData() {
				setAudioMode(configData.Actions[0].ActParam, "AudioAlarmModeStepVal");

			}

			function initLightAlarmData() {
				setLightMode(configData.Actions[1].ActParam, "LightAlarmModeStepVal");
			}

			/**
			 * 报警音列表初始化
			 */
			function initAlarmAudio() {
				SendAjax(AudioFile, 'get', function(code, data) {
					if(code == 0) {
						initAlarmStatus();
						initPlanCheckSwitch();
						initAudioAlarmData();
						initLightAlarmData();
						mui('.mui-scroll-wrapper').scroll();
						AlarmAudioList = data.FileInfoList;
						AudioChecked = AlarmAudioList[0].FileName;
						if(SupportLinkageDayNightMode) {
							var nameID = devAudioInfo.AudioDayNightInfo.Days[0].AudioDayInfo.AudioActParamInfo.AudioFileID;
							for(var j = 0; j < AlarmAudioList.length; j++) {
								if(AlarmAudioList[j].ID == nameID) {
									AudioDayNightCheckedarr[0] = AlarmAudioList[j].FileName;
								}
							}
						}

						for(var j = 0; j < AlarmAudioList.length; j++) {
							if(devAudioInfo.AudioCustomInfo.Num > 0 && devAudioInfo.AudioCustomInfo.Days[0].Num > 0 && devAudioInfo.AudioCustomInfo.Days[0].TimeSectionInfos[0]) {
								var nameID = devAudioInfo.AudioCustomInfo.Days[0].TimeSectionInfos[0].AudioActParamInfo.AudioFileID;
								if(AlarmAudioList[j].ID == nameID) {
									AudioCustomCheckedarr[0] = AlarmAudioList[j].FileName;
								}
							} else {
								AudioCustomCheckedarr[0] = AlarmAudioList[0].FileName;
							}
						}

						if(configData.Actions[0].ActParam.TimeMode == 0) {
							document.getElementById('selectAudioStepVal').innerText = AudioCustomCheckedarr[0];
						} else {
							document.getElementById('selectAudioStepVal').innerText = AudioDayNightCheckedarr[0];
						}

						getAudioAlarmList(AlarmAudioList);
						mui('#selectAudioList a').each(function(index, El) {
							if(El.innerText.trim() == AudioChecked) {
								El.parentNode.classList.add('mui-selected');
							}
						});
						backCheckData = JSON.parse(JSON.stringify(configData));
						dsBridgeFuncSyn.dismiss();
					} else {
						$("#EZView-content").addClass("mui-hidden");
						addBitmap(0);
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				})
			}

			/*
			 * 获取告警音列表
			 */
			function getAudioAlarmList(data) { // 报警音列表在页面中显示
				var selectAudioListItem = document.getElementById('selectAudioListItem');
				if(data.length <= 5) {
					selectAudioListItem.style.height = 50 * data.length + "px";
				} else {
					selectAudioListItem.style.height = 50 * 5 + "px";
				}
				var selectAudioList = document.getElementById('selectAudioList');
				for(var i = 0; i < data.length; i++) {
					var item = document.createElement('li');
					item.className = 'mui-table-view-cell installType';
					item.innerHTML = '<a class="mui-navigate-right" data-id=' + data[i].ID + ' data-value=' + i + '>&nbsp;' + data[i].FileName + '</a>';
					selectAudioList.appendChild(item);
				}
			}

			function setAudioMode(dayData, elID) {
				var modeType;
				if(dayData.TimeMode == 0) {
					modeType = langTip["WEB_CustomMode"];
				} else {
					var enabledDay = false;
					var enabledNight = false;
					if(dayData.AudioDayNightInfo.Days[0].AudioDayInfo.Enabled == 1) {
						enabledDay = true;
					}
					if(dayData.AudioDayNightInfo.Days[0].AudioNightInfo.Enabled == 1) {
						enabledNight = true;
					}
					if(enabledDay == false && enabledNight == false) {
						modeType = langTip["WEB_DayNight"];
					} else if(enabledDay == true && enabledNight == false) {
						modeType = langTip["WEB_DayNight"] + "(" + langTip["WEB_dayTime"] + ")";
					} else if(enabledDay == false && enabledNight == true) {
						modeType = langTip["WEB_DayNight"] + "(" + langTip["WEB_nightTime"] + ")";
					} else {
						modeType = langTip["WEB_DayNight"] + "(" + langTip["WEB_all_day"] + ")";
					}
				}
				$("#" + elID).text(modeType);
			}

			function setLightMode(dayData, elID) {
				var modeType;
				if(dayData.TimeMode == 0) {
					modeType = langTip["WEB_CustomMode"];
				} else {
					var enabledDay = false;
					var enabledNight = false;
					if(dayData.LightDayNightInfo.LightDayNightPlanInfo.Days[0].LightDayInfo.Enabled == 1) {
						enabledDay = true;
					}
					if(dayData.LightDayNightInfo.LightDayNightPlanInfo.Days[0].LightNightInfo.Enabled == 1) {
						enabledNight = true;
					}
					if(enabledDay == false && enabledNight == false) {
						modeType = langTip["WEB_DayNight"];
					} else if(enabledDay == true && enabledNight == false) {
						modeType = langTip["WEB_DayNight"] + "(" + langTip["WEB_dayTime"] + ")";
					} else if(enabledDay == false && enabledNight == true) {
						modeType = langTip["WEB_DayNight"] + "(" + langTip["WEB_nightTime"] + ")";
					} else {
						modeType = langTip["WEB_DayNight"] + "(" + langTip["WEB_all_day"] + ")";
					}
				}
				$("#" + elID).text(modeType);
			}

			/**
			 * 报警音确定
			 */
			function selectAudioListOk() {
				var audioID;
				var AudioInfo = configData.Actions[0].ActParam;
				mui("#selectAudioList li").each(
					function(index, El) {
						if($(El).hasClass("mui-selected")) {
							audioID = El.children[0].getAttribute("data-id");
							audioName = El.children[0].innerText;
						}
					}
				);
				saveOrg = JSON.parse(JSON.stringify(configData));

				if(SupportLinkageDayNightMode == 1) {
					for(var z = 0; z < 7; z++) {
						AudioInfo.AudioDayNightInfo.Days[z].AudioDayInfo.AudioActParamInfo.AudioFileID = Number(audioID);
					}

					for(var z = 0; z < 7; z++) {
						AudioInfo.AudioDayNightInfo.Days[z].AudioNightInfo.AudioActParamInfo.AudioFileID = Number(audioID);
					}
				}

				for(var i = 0; i < 3; i++) {
					for(var z = 0; z < 7; z++) {
						AudioInfo.AudioCustomInfo.Days[z].TimeSectionInfos[i].AudioActParamInfo.AudioFileID = Number(audioID);
					}
				}

				if(localStorage.deviceType == "0") {
					save();
				} else {
					savachl();
				}
			}

			function getIPCsendData() {
				var sendData = JSON.parse(JSON.stringify(devOrgData));
				var AudioFirst = true;
				var LightFirst = true;
				var AudioDayNightFirst = true;
				var LightDayNightFirst = true;
				var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
				var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
				for(var i = 0; i < sendData.Num; i++) {
					if(sendData.Actions[i].ActID == 28) {
						var sendAudioInfo = sendData.Actions[i].ActParam.AudioCustomInfo;
						var sendAudioDayNightInfo = sendData.Actions[i].ActParam.AudioDayNightInfo;
						var AudioDayNightInfo = configData.Actions[0].ActParam.AudioDayNightInfo;
						if(sendAudioDayNightInfo) {
							AudioDayNightFirst = false;
						}
						if(sendAudioInfo) {
							AudioFirst = false;
						}
						sendData.Actions[i].ActParam.TimeMode = configData.Actions[0].ActParam.TimeMode;
						sendData.Actions[i].Enabled = configData.Actions[0].Enabled;
						for(var m = 0; m < 7; m++) {
							var numberOfcycles = sendAudioInfo.Days[m].Num < 3 ? 3 : sendAudioInfo.Days[m].Num;
							var orangeNum = sendAudioInfo.Days[m].Num;
							for(var n = 0; n < numberOfcycles; n++) {
								if(n < 3) {
									if(n < orangeNum) {
										sendAudioInfo.Days[m].TimeSectionInfos[n].AudioActParamInfo.AudioFileID = AudioInfo.Days[m].TimeSectionInfos[n].AudioActParamInfo.AudioFileID;
										sendAudioInfo.Days[m].TimeSectionInfos[n].Enabled = AudioInfo.Days[m].TimeSectionInfos[n].Enabled;
										sendAudioInfo.Days[m].TimeSectionInfos[n].Begin = AudioInfo.Days[m].TimeSectionInfos[n].Begin;
										sendAudioInfo.Days[m].TimeSectionInfos[n].End = AudioInfo.Days[m].TimeSectionInfos[n].End;
									} else {
										if(!sendAudioInfo.Days[m].TimeSectionInfos) {
											sendAudioInfo.Days[m].TimeSectionInfos = [];

										}
										sendAudioInfo.Days[m].Num++;
										sendAudioInfo.Days[m].TimeSectionInfos.push(AudioInfo.Days[m].TimeSectionInfos[n]);
									}
								} else {
									sendAudioInfo.Days[m].TimeSectionInfos[n].Begin = "00:00:00";
									sendAudioInfo.Days[m].TimeSectionInfos[n].End = "00:00:00";
								}
							}
							//获取日夜模式其他配置原数据
							if(!AudioDayNightFirst) {
								sendAudioDayNightInfo.Days[m].AudioDayInfo.Enabled = AudioDayNightInfo.Days[m].AudioDayInfo.Enabled;
								sendAudioDayNightInfo.Days[m].AudioNightInfo.Enabled = AudioDayNightInfo.Days[m].AudioNightInfo.Enabled;
								sendAudioDayNightInfo.Days[m].AudioDayInfo.AudioActParamInfo.AudioFileID = AudioDayNightInfo.Days[m].AudioDayInfo.AudioActParamInfo.AudioFileID;
								sendAudioDayNightInfo.Days[m].AudioNightInfo.AudioActParamInfo.AudioFileID = AudioDayNightInfo.Days[m].AudioNightInfo.AudioActParamInfo.AudioFileID;
							}
						}
						if(AudioDayNightFirst) {
							sendData.Actions[i].ActParam.AudioDayNightInfo = configData.Actions[0].ActParam.AudioDayNightInfo;
						}
					}
					if(sendData.Actions[i].ActID == 29) {
						var sendLightInfo = sendData.Actions[i].ActParam.LightCustomInfo;
						var sendLightDayNightInfo = sendData.Actions[i].ActParam.LightDayNightInfo;
						var LightDayNightInfo = configData.Actions[1].ActParam.LightDayNightInfo;
						if(sendLightDayNightInfo) {
							LightDayNightFirst = false;
						}
						if(sendLightInfo) {
							LightFirst = false;
						}
						sendData.Actions[i].ActParam.TimeMode = configData.Actions[1].ActParam.TimeMode;
						sendData.Actions[i].Enabled = configData.Actions[1].Enabled;
						for(var m = 0; m < 7; m++) {
							var numberOfcycles = sendLightInfo.LightWeekPlanInfo.Days[m].Num < 3 ? 3 : sendLightInfo.LightWeekPlanInfo.Days[m].Num;
							var orangeNum = sendLightInfo.LightWeekPlanInfo.Days[m].Num;
							for(var n = 0; n < numberOfcycles; n++) {
								if(n < 3) {
									if(n < orangeNum) {
										sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Enabled = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Enabled;
										sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin;
										sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End;
									} else {
										if(!sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos) {
											sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos = [];

										}
										sendLightInfo.LightWeekPlanInfo.Days[m].Num++;
										sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos.push(LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n]);
									}
								} else {
									sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin = "00:00:00";
									sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End = "00:00:00";
								}
							}
							//获取日夜模式其他配置原数据
							if(!LightDayNightFirst) {
								sendLightDayNightInfo.LightDayNightPlanInfo.Days[m].LightDayInfo.Enabled = LightDayNightInfo.LightDayNightPlanInfo.Days[m].LightDayInfo.Enabled;
								sendLightDayNightInfo.LightDayNightPlanInfo.Days[m].LightNightInfo.Enabled = LightDayNightInfo.LightDayNightPlanInfo.Days[m].LightNightInfo.Enabled;
							}
						}
						if(LightDayNightFirst) {
							sendData.Actions[i].ActParam.LightDayNightInfo = configData.Actions[1].ActParam.LightDayNightInfo;
						}
					}
				}
				if(AudioFirst && supportAudioAlarm) {
					var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
					for(var z = 1; z < 8; z++) {
						var DayData1 = JSON.parse(JSON.stringify(Day));
						DayData1.ID = z;
						var TimeSectionInfosData1 = JSON.parse(JSON.stringify(AudioTimeSectionInfo));
						DayData1.Num++;
						DayData1.TimeSectionInfos.push(TimeSectionInfosData1);
						AudioInfo.Days.push(DayData1);
					}
					sendData.Actions.push(configData.Actions[0]);
					sendData.Num++;
				}
				if(LightFirst && supportLightAlarm) {
					var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
					for(var z = 1; z < 8; z++) {
						var DayData2 = JSON.parse(JSON.stringify(Day));
						DayData2.ID = z;
						var TimeSectionInfosData2 = JSON.parse(JSON.stringify(LightTimeSectionInfo));
						DayData2.Num++;
						DayData2.TimeSectionInfos.push(TimeSectionInfosData2);
						LightInfo.LightWeekPlanInfo.Days.push(DayData2);
					}
					sendData.Actions.push(configData.Actions[1]);
					sendData.Num++;
				}
				for(var i = 0; i < sendData.Num; i++) {
					if(sendData.Actions[i].ActID == 28) {
						if(SupportLinkageDayNightMode != 1) {
							delete sendData.Actions[i].ActParam.AudioDayNightInfo;
						}
					}
					if(sendData.Actions[i].ActID == 29) {
						if(SupportLinkageDayNightMode != 1) {
							delete sendData.Actions[i].ActParam.LightDayNightInfo;
						}
					}
				}
				return sendData;
			}

			function getNVRChannelsendData() {
				var sendData = JSON.parse(JSON.stringify(devOrgData));
				var AudioFirst = true;
				var LightFirst = true;
				var AudioDayNightFirst = true;
				var LightDayNightFirst = true;
				var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
				var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
				for(var i = 0; i < sendData.Num; i++) {
					if(sendData.Actions[i].ActID == 28) {
						var sendAudioInfo = sendData.Actions[i].ActParam.AudioCustomInfo;
						var sendAudioDayNightInfo = sendData.Actions[i].ActParam.AudioDayNightInfo;
						var AudioDayNightInfo = configData.Actions[0].ActParam.AudioDayNightInfo;
						if(sendAudioDayNightInfo) {
							AudioDayNightFirst = false;
						}
						if(sendAudioInfo) {
							AudioFirst = false;
						}
						sendData.Actions[i].ActParam.TimeMode = configData.Actions[0].ActParam.TimeMode;
						sendData.Actions[i].Enabled = configData.Actions[0].Enabled;
						sendAudioInfo.Days.Num = 8;
						for(var m = 0; m < 7; m++) {
							var numberOfcycles = sendAudioInfo.Days[m].Num < 3 ? 3 : sendAudioInfo.Days[m].Num;
							var orangeNum = sendAudioInfo.Days[m].Num;
							for(var n = 0; n < numberOfcycles; n++) {
								if(n < 3) {
									if(n < orangeNum) {
										sendAudioInfo.Days[m].TimeSectionInfos[n].AudioActParamInfo.AudioFileID = AudioInfo.Days[m].TimeSectionInfos[n].AudioActParamInfo.AudioFileID;
										sendAudioInfo.Days[m].TimeSectionInfos[n].Enabled = AudioInfo.Days[m].TimeSectionInfos[n].Enabled;
										sendAudioInfo.Days[m].TimeSectionInfos[n].Begin = AudioInfo.Days[m].TimeSectionInfos[n].Begin;
										sendAudioInfo.Days[m].TimeSectionInfos[n].End = AudioInfo.Days[m].TimeSectionInfos[n].End;
									} else {
										if(!sendAudioInfo.Days[m].TimeSectionInfos) {
											sendAudioInfo.Days[m].TimeSectionInfos = [];

										}
										sendAudioInfo.Days[m].Num++;
										sendAudioInfo.Days[m].TimeSectionInfos.push(AudioInfo.Days[m].TimeSectionInfos[n]);
									}
								} else {
									sendAudioInfo.Days[m].TimeSectionInfos[n].Begin = "00:00:00";
									sendAudioInfo.Days[m].TimeSectionInfos[n].End = "00:00:00";
								}
							}
							if(!AudioDayNightFirst) {
								sendAudioDayNightInfo.Days[m].AudioDayInfo.Enabled = AudioDayNightInfo.Days[m].AudioDayInfo.Enabled;
								sendAudioDayNightInfo.Days[m].AudioNightInfo.Enabled = AudioDayNightInfo.Days[m].AudioNightInfo.Enabled;
								sendAudioDayNightInfo.Days[m].AudioDayInfo.AudioActParamInfo.AudioFileID = AudioDayNightInfo.Days[m].AudioDayInfo.AudioActParamInfo.AudioFileID;
								sendAudioDayNightInfo.Days[m].AudioNightInfo.AudioActParamInfo.AudioFileID = AudioDayNightInfo.Days[m].AudioNightInfo.AudioActParamInfo.AudioFileID;
							}
						}
						if(AudioDayNightFirst) {
							sendData.Actions[i].ActParam.AudioDayNightInfo = configData.Actions[0].ActParam.AudioDayNightInfo;
						}
					}
					if(sendData.Actions[i].ActID == 29) {
						var sendLightInfo = sendData.Actions[i].ActParam.LightCustomInfo;
						var sendLightDayNightInfo = sendData.Actions[i].ActParam.LightDayNightInfo;
						var LightDayNightInfo = configData.Actions[1].ActParam.LightDayNightInfo;
						if(sendLightDayNightInfo) {
							LightDayNightFirst = false;
						}
						if(sendLightInfo) {
							LightFirst = false;
						}
						sendData.Actions[i].ActParam.TimeMode = configData.Actions[1].ActParam.TimeMode;
						sendData.Actions[i].Enabled = configData.Actions[1].Enabled;
						sendAudioInfo.Days.Num = 8;
						for(var m = 0; m < 7; m++) {
							var numberOfcycles = sendLightInfo.LightWeekPlanInfo.Days[m].Num < 3 ? 3 : sendLightInfo.LightWeekPlanInfo.Days[m].Num;
							var orangeNum = sendLightInfo.LightWeekPlanInfo.Days[m].Num;
							for(var n = 0; n < numberOfcycles; n++) {
								if(n < 3) {
									if(n < orangeNum) {
										sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Enabled = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Enabled;
										sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin;
										sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End;
									} else {
										if(!sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos) {
											sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos = [];

										}
										sendLightInfo.LightWeekPlanInfo.Days[m].Num++;
										sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos.push(LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n]);
									}
								} else {
									sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin = "00:00:00";
									sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End = "00:00:00";
								}
							}
							if(!LightDayNightFirst) {
								sendLightDayNightInfo.LightDayNightPlanInfo.Days[m].LightDayInfo.Enabled = LightDayNightInfo.LightDayNightPlanInfo.Days[m].LightDayInfo.Enabled;
								sendLightDayNightInfo.LightDayNightPlanInfo.Days[m].LightNightInfo.Enabled = LightDayNightInfo.LightDayNightPlanInfo.Days[m].LightNightInfo.Enabled;
							}
						}
						if(LightDayNightFirst) {
							sendData.Actions[i].ActParam.LightDayNightInfo = configData.Actions[1].ActParam.LightDayNightInfo;
						}
					}
				}
				if(AudioFirst && supportAudioAlarm) {
					sendData.Actions.push(configData.Actions[0]);
					sendData.Num++;
				}
				if(LightFirst && supportLightAlarm) {
					sendData.Actions.push(configData.Actions[1]);
					sendData.Num++;
				}
				for(var i = 0; i < sendData.Num; i++) {
					if(sendData.Actions[i].ActID == 28) {
						if(SupportLinkageDayNightMode != 1) {
							delete sendData.Actions[i].ActParam.AudioDayNightInfo;
						}
					}
					if(sendData.Actions[i].ActID == 29) {
						if(SupportLinkageDayNightMode != 1) {
							delete sendData.Actions[i].ActParam.LightDayNightInfo;
						}
					}
				}
				return sendData;
			}

			function getDevSendData() {
				if(localStorage.deviceType == "0") {
					return getIPCsendData();
				} else {
					return getNVRChannelsendData();
				}
			}

			function setTarget() {
				var tarList = [];
				mui('#CaptureTargetList input').each(function(index, El) {
					console.log(El);
					console.log(El.checked);
					if(El.checked) {
						tarList.push(El.previousElementSibling.innerText.trim());
					}
				});
				var str = "";
				for(var i = 0; i < tarList.length; i++) {
					if(i == 0) {
						str = tarList[i];
					} else {
						str = str + "、" + tarList[i];
					}
				}
				document.getElementById("AccessZoneCaptureTargetItemStepVal").innerText = str;
			}
			/******************新增原生App上报Web功能接口******************/
			//TODO:监听原生侧上报事件
			dsBridge.register("callWebDoFuncAsyn", function(args) {
				var webInfo = JSON.parse(args);
				for(var key in webInfo) {
					switch(webInfo[key].whichInfo) {
						case "updateGrid": // 绘图数据发还给进入区域配置页面
							var param = JSON.parse(webInfo[key].infoValue);
							AccessZoneGridService = param.Grid_Bak;
							break;
						case "updateConfigData": // 报警联动数据还给运检测配置页面
							var param = JSON.parse(webInfo[key].infoValue);
							configData = JSON.parse(JSON.stringify(param.configData));
							if(param.ActID == 0) {
								initAudioAlarmData();
							} else {
								initLightAlarmData();
							}
							var showAudio;
							if(configData.Actions[0].ActParam.TimeMode == 0) {
								for(var j = 0; j < AlarmAudioList.length; j++) {
									if(configData.Actions[0].ActParam.AudioCustomInfo.Num > 0 && configData.Actions[0].ActParam.AudioCustomInfo.Days[0].Num > 0 && configData.Actions[0].ActParam.AudioCustomInfo.Days[0].TimeSectionInfos[0]) {
										var nameID = configData.Actions[0].ActParam.AudioCustomInfo.Days[0].TimeSectionInfos[0].AudioActParamInfo.AudioFileID;
										if(AlarmAudioList[j].ID == nameID) {
											showAudio = AlarmAudioList[j].FileName;
										}
									} else {
										showAudio = AlarmAudioList[0].FileName;
									}
								}
								document.getElementById('selectAudioStepVal').innerText = showAudio;
							} else {
								var nameID = configData.Actions[0].ActParam.AudioDayNightInfo.Days[0].AudioDayInfo.AudioActParamInfo.AudioFileID;
								for(var j = 0; j < AlarmAudioList.length; j++) {
									if(AlarmAudioList[j].ID == nameID) {
										showAudio = AlarmAudioList[j].FileName;
									}
								}
								document.getElementById('selectAudioStepVal').innerText = showAudio;
							}
							break;
						case "deviceStatus": // 更新设备在线状态
							localStorage.deviceStatus = webInfo[key].infoValue;
							break;
						case "ip": // 更新ip
							localStorage.Ip = webInfo[key].infoValue;
							break;
						case "port": // 更新port
							localStorage.Port = webInfo[key].infoValue;
							break;
						case "logInfo": //更新登录信息
							localStorage.logInfo = webInfo[key].infoValue;
							break;
						case "deviceName": //更新设备名称
							var deviceName = document.getElementById("deviceName");
							break;
						case "sdkType": //更新SDK类型
							localStorage.sdkType = webInfo[key].infoValue;
							break;
						case "isNetConnect": //更新手机是否联网
							localStorage.isNetConnect = webInfo[key].infoValue;
							break;
						case "hasNewVersion": //是否有新版本
							localStorage.hasNewVersion = webInfo[key].infoValue;
							break;
						case "versionNumber": //当前版本号
							localStorage.versionNumber = webInfo[key].infoValue;
							break;
						case "LocalDeviceUname": //免注册设备用户名更新
							localStorage.LocalDeviceUname = webInfo[key].infoValue;
							break;
						case "deviceOs": //设备云端在线状态 “true”在线，“false”离线
							localStorage.deviceOs = webInfo[key].infoValue;
							break;
						case "updateChannelName": // TODO：通道名称修改成功后，主页同步更新
							localStorage.deviceName = webInfo[key].infoValue;
							break;
						case "workingStatus":
							localStorage.workingStatus = webInfo[key].infoValue;
							break;
						case "channelStatus":
							localStorage.channelStatus = webInfo[key].infoValue;
							break;
						default:
							break;
					}
				}
			})
		</script>
	</body>

</html>