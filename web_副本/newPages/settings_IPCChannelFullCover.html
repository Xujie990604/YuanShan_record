<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<title></title>
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/iconfont.css" rel="stylesheet" />
		<link href="../css/Common.css" rel="stylesheet" />
		<link href="../css/theme_normal.css" rel="stylesheet" />
		<style>
			.private-title {
				height: 18px;
				line-height: 30px;
				font-size: 12px;
				color: #999999;
				padding-left: 17px;
			}
			
			.private-settings-img {
				width: 24px;
			}
			
			.mui-row .mui-table-view-cell {
				text-align: center;
				font-size: 12px;
			}
			
			.imgTitles {
				width: 100%;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="back" class="mui-icon iconfont icon-back1"></a>
			<h1 id="title" class="mui-title" data-text="WEB_Full_Coverage">&nbsp;</h1>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view mui-hidden" id="NVRFull">
				<li id="setSDcard" class="mui-table-view-cell">
					<span data-text="WEB_Full_Coverage" class="mainStyle">&nbsp;</span>
					<div id="setSDcardSwitch" class="mui-switch mui-switch-mini">
						<div class="mui-switch-handle" id="setSDcardCircle"></div>
					</div>
					<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
				</li>
			</ul>
		</div>

		<script src="../js/dsbridge.min.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/libs/md5.js"></script>
		<script src="../js/libs/jquery-3.4.1.min.js"></script>
		<script src="../js/libs/sha2.js"></script>
		<script src="../js/resource.js"></script>
		<script src="../js/Utils.js"></script>
		<script src="../js/mui.js"></script>
		<script src="../js/immersed.js"></script>
		<script src="../js/customSetting.js"></script>
		<script src="../js/loadCss.js"></script>
    <script id="langScript"></script>
		<script>
			var langTip;
			var SportCheckConfirm = true; //满覆盖开关状态变化时是否调接口提交
			var getSDError = false;
			var SDCardTips = document.getElementById("SDCardTips");
			var SDcardServiceData;
			var overStoreCheck;
			var setSDcardConfirm = true;
			var coverObj = {};
			checkType(localStorage.AppType); //加载特定样式
			mui.init();
			var typeLan = initLang();
			langTip = typeLan.lang;
			initData();

			function initData() {
				initSDcardData();
			}

			function initSDcardData() {
				SendAjax(LAPI.Storage, "get", function(code, data) {
					if(code == 0) {
						$("#NVRFull").removeClass("mui-hidden");
						SDcardServiceData = deepCopy(data);
						overStoreCheck = data.VideoStorage.StoragePolicy;
						coverObj = data;
						document.getElementById("setSDcardSwitch").style.zIndex = 20;
						document.getElementById("setSDcardSwitch").style.visibility = "visible";
						setSDcardConfirm = false;
						setSwitchStatus("setSDcardSwitch", overStoreCheck);
						setSDcardConfirm = true;
						var setSDcardActive = document.getElementById("setSDcardSwitch").classList.contains("mui-active")
						if(setSDcardActive) {
							document.getElementById("setSDcardCircle").style.transform = "translate(16px, 0px)";
						}
						dsBridgeFuncSyn.dismiss();
					} else {
						$("#setSDcard div.loadFailed").removeClass("mui-hidden");
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				})
			}

			/*
			 *  监听满覆盖开关
			 */
			document.getElementById("setSDcardSwitch").addEventListener("toggle", function(event) {
				if(event.detail.isActive && setSDcardConfirm) {
					var sendDataON = deepCopy(SDcardServiceData);
					sendDataON.VideoStorage.StoragePolicy = 1;
					dsBridgeFuncSyn.showLoading();
					SendAjax(LAPI.Storage, "put", function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {

						} else {
							setSDcardConfirm = false;
							showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
							setTimeout(function() {
								mui("#setSDcardSwitch").switch().toggle();
							}, 200)
						}
					}, sendDataON)
				} else if(!event.detail.isActive && setSDcardConfirm) {
					var sendDataOFF = deepCopy(SDcardServiceData);
					sendDataOFF.VideoStorage.StoragePolicy = 0;
					SendAjax(LAPI.Storage, "put", function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {

						} else {
							setSDcardConfirm = false;
							showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
							setTimeout(function() {
								mui("#setSDcardSwitch").switch().toggle()
							}, 200)
						}
					}, sendDataOFF)
				} else {
					setSDcardConfirm = true;
				}
			})
		</script>
	</body>

</html>