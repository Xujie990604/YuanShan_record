<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title></title>
  <link href="../css/mui.css" rel="stylesheet" />
  <link href="../css/iconfont.css" rel="stylesheet" />
  <link href="../css/Common.css" rel="stylesheet" />
  <link href="../css/theme_normal.css" rel="stylesheet" />
  <style>
    /* 顶部搜索框 */
    #searchInputContent {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 56px;
      background-color: #fff;
    }

    #searchInputContent .input-content {
      display: flex;
      flex-direction: row;
      align-items: center;
      width: 78%;
      height: 36px;
      margin: 0 0 0 4%;
      border-radius: 18px;
      background-color: rgba(0, 0, 0, 0.05);
    }

    .mui-icon-search {
      margin-left: 10px;
      font-size: 18px;
    }

    .input-content input {
      height: 100%;
      margin: 0;
      padding-left: 5px;
      background-color: transparent;
      text-align: left;
    }

    .cancel-search {
      margin-right: 4%;
      background-color: #fff;
    }

    #userInfoListContent {
      position: relative;
      margin-top: 20px;
    }

    #userInfoListContent ul {
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }


    #userInfoListContent li {
      position: relative;
      list-style: none;
      height: 96px;
      width: 94%;
      margin-bottom: 12px;
      border-radius: 8px;
      background-color: #fff;
    }

    #userInfoListContent li a {
      display: flex;
      flex-direction: row;
      align-items: center;
      height: 100%;
    }

    #userInfoListContent li img {
      height: 35px;
      margin: 0 10px 0 20px;
    }

    #userInfoListContent li .user-info {
      display: flex;
      flex-direction: column;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.6);
      font-weight: 400;
    }

    /* 无搜索记录的占位图 */

    .no-search-record {
      height: 180px;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .no-search-record-img {
      width: 100px;
    }

    ..no-search-record-img {
      color: rgba(0, 0, 0, 0.6);
      font-size: 18px;
      font-weight: 400;
    }
  </style>
</head>

<body>
  <!-- 页面标题 -->
  <header class="mui-bar mui-bar-nav">
    <a id="back" class="mui-icon iconfont icon-back1"></a>
    <h1 id="title" class="mui-title" data-text="">搜索界面</h1>
  </header>
  <div class="mui-content">
    <div id="EZView-content">
      <!-- input：搜索框 -->
      <div id="searchInputContent" class="mui-input-row search-input-content">
        <div class="input-content">
          <span class="mui-icon mui-icon-search"></span>
          <input id="searchInput" type="search">
        </div>
        <button id="cancelSearch" class="cancel-search">取消</button>
      </div>
      <!-- 列表：分享用户的列表 -->
      <div id="userInfoListContent" class="mui-hidden">
        <div class="mui-scroll-wrapper">
          <div class="mui-scroll">
            <ul id="userInfoListUL">
              <!-- 用户卡片模板 -->
              <!-- TODO: 内容要开启超长打点 -->
              <li class="user-info-card-template mui-hidden">
                <a class="mui-navigate-right">
                  <!-- TODO: 更换用户的头像 -->
                  <img src="../images/human_detection.png">
                  <div class="user-info">
                    <span>userName(188xxxx8888)</span>
                    <span>备注：分享的配置</span>
                    <span>设备：x台</span>
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <!-- 无搜索记录时的 -->
      <div id="noSearchRecord" class="no-search-record mui-hidden">
        <img class="no-search-record-img" src="../images/batchShareDevice/noSearchUserInfo.png">
        <span class="no-search-record-text">暂无数据</span>
      </div>
    </div>
  </div>
  <script src="../js/dsbridge.min.js"></script>
  <script src="../js/common.js"></script>
  <script src="../js/libs/md5.js"></script>
  <script src="../js/libs/jquery-3.4.1.min.js"></script>
  <script src="../js/libs/sha2.js"></script>
  <script src="../js/resource.js"></script>
  <script src="../js/Utils.js"></script>
  <script src="../js/mui.js"></script>
  <script src="../js/immersed.js"></script>
  <script src="../js/customSetting.js"></script>
  <script src="../js/loadCss.js"></script>
  <script src="../js/batchShareDeviceUtil.js"></script>
  <script id="langScript"></script>
  <script>
    var langTip;
    checkType(localStorage.AppType); //加载特定样式
    mui.init();
    // 获取语言文件
    var typeLan = initLang();
    langTip = typeLan.lang;
    dsBridgeFuncSyn.dismiss();


    // 初始化页面
    initPage()
    // 初始化数据
    initData();
    // 初始化事件
    initEvent()


    function initPage() {
      mui('.mui-scroll-wrapper').scroll();
    }

    function initData() {
    }

    function initEvent() {
      // 输入框的值发生变化，调用接口请求数据
      // TODO：是不是所有的手机都能有搜索这个按钮
      $('#searchInput').on('change', getShareUserListByKeyword)

      // 绑定事件：取消查询返回上一个页面
      $('#cancelSearch').on('tap', function () {
        dsBridgeFuncSyn.backTo();
      })
    }

    // 获取用户列表
    // 有参数为条件查询，无参数为获取所有信息
    function getShareUserListByKeyword() {
      var sendData = {}
      var keyWord = $('#searchInput').val().trim()
      sendData.keyWord = keyWord == "" ? null : keyWord
      dsBridgeFuncSyn.showLoading();
      CloudSendAjax(localStorage.serverAddress + openAPI.shareUserList, 'post', function (code, message, data) {
        // TODO：模拟数据
        if (isMock) {
          code = 200;
          data = {
            shareUserList: [
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              },
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              },
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              },
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              },
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              },
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              },
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              },
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              },
              {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              }, {
                userId: 355555555555555555,
                userName: "uniview1",
                phone: "18730508685",
                email: "",
                remark: "仓库的设备",
                total: 3
              }
            ]
          }
        }
        if (code == 200) {
          // 有搜索记录：根据数据生成列表
          if (data.shareUserList.length > 0) {
            buildUserInfoList(data.shareUserList);
            $('#userInfoListContent').removeClass('mui-hidden');
            $('#noSearchRecord').addClass("mui-hidden")
            var scrollTop = $('#userInfoListContent').offset().top;
            // 21px 是页面底部的固定高度
            $('#userInfoListContent').css("height", "calc(100vh - (" + scrollTop + "px + 21px))");
          } else {
            // 无搜索记录：展示异常占位图
            $('#userInfoListContent').addClass('mui-hidden');
            $('#noSearchRecord').removeClass("mui-hidden")
          }
          dsBridgeFuncSyn.dismiss();
        } else {
          addBitmap(0);
          showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
          dsBridgeFuncSyn.dismiss();
        }
      }, sendData)
    }

    // 事件处理函数：跳转到分享详情页面
    function turnToShareDetailPage() {
      // 页面跳转：
      var param = {
        userId: $(this).attr('data-userId'),
        userName: $(this).find("span").eq(0).text(),
        remark: $(this).find("span").eq(1).text()
      }
      dsBridgeFuncSyn.pageTo("web/newPages/batchShareDeviceDetail.html", JSON.stringify(param));
    }











  </script>
</body>

</html>