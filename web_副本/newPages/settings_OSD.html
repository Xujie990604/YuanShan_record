<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<title></title>
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/iconfont.css" rel="stylesheet" />
		<link href="../css/Common.css" rel="stylesheet" />
		<link href="../css/theme_normal.css" rel="stylesheet" />
		<style>
			.mui-table-view-cell .ui-tip {
				position: absolute;
				right: 5px;
				top: 20px;
				z-index: 100;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="back" class="mui-icon iconfont icon-back1"></a>
			<h1 id="title" class="mui-title" data-text="WEB_OSD_config">&nbsp;</h1>
		</header>
		<div class="mui-content">
			<div id="EZView-content" class="mui-hidden">
				<!--显示通道名称-->
				<ul id="ChannelNameCheck" class="mui-table-view ui-siwtchlist mui-hidden">
					<li id="ChannelNameCheckItem" class="mui-table-view-cell">
						<span data-text="WEB_show_channel_name" class="mainStyle">&nbsp;</span>
						<div id="ChannelNameCheckSwitch" class="mui-switch mui-switch-mini">
							<div class="mui-switch-handle"></div>
						</div>
						<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
					</li>
					<li id="channelNameSiteItem" class="mui-table-view-cell mui-hidden">
						<a href="#channelNameSite" class="mui-navigate-right">&nbsp;
							<span data-text="WEB_channel_name_site" class="mainStyle padding-left-15">&nbsp;</span>
							<span id="channelNameSiteVal" class="mui-badge"></span>
						</a>
					</li>
				</ul>
				<!--显示时间日期-->
				<ul id="OSDTimeAndDateCheck" class="mui-table-view ui-siwtchlist">
					<li id="OSDTimeCheckItem" class="mui-table-view-cell">
						<span data-text="WEB_show_time_and_date" class="mainStyle">&nbsp;</span>
						<div id="OSDTimeAndDateCheckSwitch" class="mui-switch mui-switch-mini">
							<div class="mui-switch-handle"></div>
						</div>
						<div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
					</li>
					<li id="OSDTimeSiteItem" class="mui-table-view-cell mui-hidden">
						<a href="#OSDTimeAndDateSite" class="mui-navigate-right">&nbsp;
							<span data-text="WEB_time_and_date_site" class="mainStyle padding-left-15">&nbsp;</span>
							<span id="OSDTimeAndDateSiteVal" class="mui-badge"></span>
						</a>
					</li>
					<li id="OSDTimeFormatItem" class="mui-table-view-cell mui-hidden">
						<a href="#OSDTimeFormatFrame" class="mui-navigate-right">&nbsp;
							<span data-text="WEB_time_format" class="mainStyle padding-left-15">&nbsp;</span>
							<span id="OSDTimeFormatFrameVal" class="mui-badge"></span>
						</a>
					</li>
					<li id="OSDDateFormatItem" class="mui-table-view-cell mui-hidden">
						<a href="#OSDDateFormatFrame" class="mui-navigate-right">&nbsp;
							<span data-text="WEB_date_format" class="mainStyle padding-left-15">&nbsp;</span>
							<span id="OSDDateFormatFrameVal" class="mui-badge"></span>
						</a>
					</li>
				</ul>

			</div>
		</div>
		<!--OSD通道名称位置 弹框-->
		<div id="channelNameSite" class="mui-popover mui-popover-action mui-popover-bottom ui-radio-list">
			<form class="mui-input-group">
				<div class="mui-input-row mui-checkbox ui-list-titile" id="swipedownDiv1">
					<label data-text="WEB_channel_name_site">&nbsp;</label>
					<span id="closeChannelNameSiteList" class="mui-icon mui-icon-closeempty"></span>
				</div>
				<ul id="channelNameSiteList" class="mui-table-view mui-table-view-radio">
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="AreaTopLeft" data-text="WEB_area_top_left">&nbsp;</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="AreaTopRight" data-text="WEB_area_top_right">&nbsp;</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="AreaBottomRight" data-text="WEB_area_bottom_right">&nbsp;</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="AreaBottomLeft" data-text="WEB_area_bottom_left">&nbsp;</a>
					</li>
				</ul>
			</form>
			<button id="channelNameSiteOk" class="mui-btn mui-btn-block ui-dateok" data-text="WEB_button_ok">&nbsp;</button>
		</div>

		<!--OSD时间日期显示位置 弹框-->
		<div id="OSDTimeAndDateSite" class="mui-popover mui-popover-action mui-popover-bottom ui-radio-list">
			<form class="mui-input-group">
				<div class="mui-input-row mui-checkbox ui-list-titile" id="swipedownDiv2">
					<label data-text="WEB_time_and_date_site">&nbsp;</label>
					<span id="closeOSDTimeAndDateSiteList" class="mui-icon mui-icon-closeempty"></span>
				</div>
				<ul id="OSDTimeAndDateSiteList" class="mui-table-view mui-table-view-radio">
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="AreaTopLeft" data-text="WEB_area_top_left">&nbsp;</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="AreaTopRight" data-text="WEB_area_top_right">&nbsp;</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="AreaBottomRight" data-text="WEB_area_bottom_right">&nbsp;</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="AreaBottomLeft" data-text="WEB_area_bottom_left">&nbsp;</a>
					</li>
				</ul>
			</form>
			<button id="OSDTimeAndDateSiteOk" class="mui-btn mui-btn-block ui-dateok" data-text="WEB_button_ok">&nbsp;</button>
		</div>

		<!--OSD时间格式弹框-->
		<div id="OSDTimeFormatFrame" class="mui-popover mui-popover-action mui-popover-bottom ui-radio-list">
			<form class="mui-input-group">
				<div class="mui-input-row mui-checkbox ui-list-titile" id="swipedownDiv3">
					<label data-text="WEB_time_format">&nbsp;</label>
					<span id="closeOSDTimeFormat" class="mui-icon mui-icon-closeempty"></span>
				</div>
				<ul id="OSDTimeFormatList" class="mui-table-view mui-table-view-radio">
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="0">HH:mm:ss</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" data-value="2">hh:mm:ss tt</a>
					</li>
				</ul>
			</form>
			<button id="OSDTimeFormatOk" class="mui-btn mui-btn-block ui-dateok" data-text="WEB_button_ok">&nbsp;</button>
		</div>

		<!--OSD日期格式弹框-->
		<div id="OSDDateFormatFrame" class="mui-popover mui-popover-action mui-popover-bottom ui-radio-list">
			<form class="mui-input-group">
				<div class="mui-input-row mui-checkbox ui-list-titile" id="swipedownDiv4">
					<label data-text="WEB_date_format">&nbsp;</label>
					<span id="closeOSDDateFormat" class="mui-icon mui-icon-closeempty"></span>
				</div>
				<ul id="OSDDateFormatList" class="mui-table-view mui-table-view-radio">
					<li class="mui-table-view-cell cnFormat">
						<a class="mui-navigate-right" data-value="0">yyyy-MM-dd</a>
					</li>
					<li class="mui-table-view-cell cnFormat">
						<a class="mui-navigate-right" data-value="2">yyyy年MM月dd日</a>
					</li>
					<li class="mui-table-view-cell cnFormat">
						<a class="mui-navigate-right" data-value="4">yyyy年MM月dd日星期X</a>
					</li>
					<li class="mui-table-view-cell enFormat">
						<a class="mui-navigate-right" data-value="101">MM/dd/yyyy</a>
					</li>
					<li class="mui-table-view-cell enFormat">
						<a class="mui-navigate-right" data-value="106">yyyy/MM/dd</a>
					</li>
				</ul>
			</form>
			<button id="OSDDateFormatOk" class="mui-btn mui-btn-block ui-dateok" data-text="WEB_button_ok">&nbsp;</button>
		</div>

		<script src="../js/dsbridge.min.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/libs/md5.js"></script>
		<script src="../js/libs/jquery-3.4.1.min.js"></script>
		<script src="../js/libs/sha2.js"></script>
		<script src="../js/resource.js"></script>
		<script src="../js/Utils.js"></script>
		<script src="../js/mui.js"></script>
		<script src="../js/immersed.js"></script>
		<script src="../js/customSetting.js"></script>
		<script src="../js/loadCss.js"></script>
    <script id="langScript"></script>
		<script>
			var langTip;
			var langType;
			var ChannelNameCheckConfirm = true; // 通道名称 开关状态变化时是否调接口提交
			var showChannelName; // 是否显示通道名称 
			var channelNameSiteVal; // 通道名称位置 取值
			var channelNameSiteChecked = ''; // 通道名称列表选中项

			var OSDTimeAndDateCheckConfirm = true; // OSD时间日期 开关状态变化时是否调接口提交
			var showOSDTimeAndDate; // 是否显示OSD时间日期 
			var OSDTimeAndDateSiteVal; // OSD时间日期位置 取值

			var TimeFormat = ""; // OSD时间格式 取值
			var OSDTimeFormatChecked = ''; // OSD时间格式 选中项

			var DateFormat = ""; // OSD日期格式 取值
			var OSDDateFormatChecked = ''; // OSD日期格式选中项

			var OSDsContentsServiceData = {}; // OSD配置信息
			var OSDsContentsServiceDataMap = {}; // OSD配置信息 备份
			var OSDCapabilitiesData = {}; //OSD能力详情
			var AreaData = ""; // 区域位置	

			var OSDsStyleServiceData = {}; // OSD样式信息
			var OSDsStyleServiceDataMap = {}; // OSD样式 备份

			// OSD日期/时间格式 key值
			var timeFrameIndex = "";
			var dateFrameIndex = "";

			checkType(localStorage.AppType); // 加载特定样式
			var SDClickednum = 0; // 点击刷新次数
			mui.init();
			var typeLan = initLang();
			langTip = typeLan.lang;
			langType = typeLan.type;
			initPage();
			initData();
			initEvent();

			function initPage() {
				if(localStorage.deviceType == "1" && localStorage.channelId != "0") {
					$("#ChannelNameCheck").removeClass("mui-hidden");
				}
				if(langType == "zh") { //国内版本与海外版本 OSD日期格式有差异
					$(".enFormat").addClass("mui-hidden");
				} else {
					$(".cnFormat").addClass("mui-hidden");
				}
			}

			function initData() {
				initOSDCapabilities();
			}

			function initEvent() {
				/****************   OSD通道名称   ****************/
				document.getElementById("ChannelNameCheckSwitch").addEventListener("toggle", function(event) {
					ChannelNameCheckSwitch(event); //监听 通道名称显示 开关
				});
				// 通道名称位置列表 初始化选择状态
				document.getElementById('channelNameSiteList').addEventListener('selected', function(e) {
					channelNameSiteChecked = e.detail.el.innerText.trim();
				});
				// 关闭通道名称位置列表
				document.getElementById('closeChannelNameSiteList').addEventListener('tap', closeChannelNameSiteList);
				// 选中通道名称位置、下发参数、关闭列表上拉框
				document.getElementById('channelNameSiteOk').addEventListener('tap', channelNameSiteOk);
				// 通道名称位置 选择事件
				mui("#channelNameSite").on("tap", ".mui-table-view-cell a", function() {
					var nowValue = this.innerHTML;
					AreaData = this.getAttribute("data-value");
					document.getElementById('channelNameSiteVal').innerText = nowValue;
				})

				// 手势操作：向下滑动关闭弹框
				document.getElementById("swipedownDiv1").addEventListener("swipedown", function() {
					mui('#channelNameSite').popover('toggle');
				});

				/****************   OSD时间日期  使能、位置   ****************/
				document.getElementById("OSDTimeAndDateCheckSwitch").addEventListener("toggle", function(event) {
					OSDTimeAndDateCheckSwitch(event); //监听 通道名称显示 开关
				});
				// OSD时间日期位置上拉框 初始化选择状态
				document.getElementById('OSDTimeAndDateSiteList').addEventListener('selected', function(e) {
					OSDTimeAndDateSiteVal = e.detail.el.innerText.trim();
				});
				// 关闭OSD时间日期位置上拉框
				document.getElementById('closeOSDTimeAndDateSiteList').addEventListener('tap', closeOSDTimeAndDateSiteList);
				// 选中OSD时间日期位置、下发参数、关闭列表上拉框
				document.getElementById('OSDTimeAndDateSiteOk').addEventListener('tap', OSDTimeAndDateSiteOk);
				// OSD时间日期位置 选择事件
				mui("#OSDTimeAndDateSite").on("tap", ".mui-table-view-cell a", function() {
					var nowValue = this.innerHTML;
					AreaData = this.getAttribute("data-value");
					document.getElementById('OSDTimeAndDateSiteVal').innerText = nowValue;
				})

				// 手势操作：向下滑动关闭弹框
				document.getElementById("swipedownDiv2").addEventListener("swipedown", function() {
					mui('#OSDTimeAndDateSite').popover('toggle');
				});

				/****************   OSD时间格式   ****************/
				// OSD时间格式 上拉框 初始化选择状态
				document.getElementById('OSDTimeFormatList').addEventListener('selected', function(e) {
					OSDTimeFormatChecked = e.detail.el.innerText.trim();
				});
				// 关闭OSD时间格式上拉框
				document.getElementById('closeOSDTimeFormat').addEventListener('tap', closeOSDTimeFormat);
				// 选中OSD时间格式、下发参数、关闭列表上拉框
				document.getElementById('OSDTimeFormatOk').addEventListener('tap', OSDTimeFormatOk);
				// OSD时间格式 选择事件
				mui("#OSDTimeFormatFrame").on("tap", ".mui-table-view-cell a", function() {
					var nowValue = this.innerHTML;
					timeFrameIndex = this.getAttribute("data-value");
					document.getElementById('OSDTimeFormatFrameVal').innerText = nowValue;
				})

				// 手势操作：向下滑动关闭弹框
				document.getElementById("swipedownDiv3").addEventListener("swipedown", function() {
					mui('#OSDTimeFormatFrame').popover('toggle');
				});

				/****************   OSD日期格式   ****************/
				// OSD日期格式 上拉框 初始化选择状态
				document.getElementById('OSDDateFormatList').addEventListener('selected', function(e) {
					OSDDateFormatChecked = e.detail.el.innerText.trim();
				});
				// 关闭OSD日期格式上拉框
				document.getElementById('closeOSDDateFormat').addEventListener('tap', closeOSDDateFormat);
				// 选中OSD日期格式、下发参数、关闭列表上拉框
				document.getElementById('OSDDateFormatOk').addEventListener('tap', OSDDateFormatOk);
				// OSD日期格式 选择事件
				mui("#OSDDateFormatFrame").on("tap", ".mui-table-view-cell a", function() {
					var nowValue = this.innerHTML;
					dateFrameIndex = this.getAttribute("data-value");
					document.getElementById('OSDDateFormatFrameVal').innerText = nowValue;
				})

				// 手势操作：向下滑动关闭弹框
				document.getElementById("swipedownDiv4").addEventListener("swipedown", function() {
					mui('#OSDDateFormatFrame').popover('toggle');
				});
			}

			/*
			 * 发请求 获取OSD能力数据
			 */
			function initOSDCapabilities() {
				SendAjax(LAPI.OSDCapabilities, 'get', function(code, data) {
					if(code == 0) {
						OSDCapabilitiesServiceData = deepCopy(data); //能力数据暂时没有用到
						IsSupportCfg = data.IsSupportCfg;
						//若运动检测开启则显示配置选项并初始化
						if(IsSupportCfg == 1) {
							initOSDConfig();
						} else {
							addBitmap(1, langTip["WEB_unSupported"]);
							dsBridgeFuncSyn.dismiss();
						}
					} else if(code == 4 || code == 8 || code == 1006) {
						addBitmap(1, langTip["WEB_unSupported"]);
						dsBridgeFuncSyn.dismiss();
					} else {
						//TODO:加载失败显示加载失败占位图
						addBitmap(0);
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				});
			}

			/*
			 * 初始化 通道名称显示、位置信息 数据
			 */
			function initOSDConfig() {
				var IPCPosition = "";
				SendAjax(LAPI.OSDsContents, 'get', function(code, ConfigData) {
					if(code == 0) {
						$("#EZView-content").removeClass("mui-hidden");
						OSDsContentsServiceData = deepCopy(ConfigData);
						OSDsContentsServiceDataMap = deepCopy(OSDsContentsServiceData);
						SendAjax(LAPI.OSDStyle, 'get', function(code, StyleData) {
							if(code == 0) {
								OSDsStyleServiceData = deepCopy(StyleData);
								OSDsStyleServiceDataMap = deepCopy(OSDsStyleServiceData);
								// 判断直连IPC还是NVR下通道
								if(!(localStorage.deviceType == "1" && localStorage.channelId != "0")) { // 直连IPC
									IPCPosition = 0;
									document.getElementById("OSDTimeAndDateCheckSwitch").style.zIndex = 20;
									document.getElementById("OSDTimeAndDateCheckSwitch").style.visibility = "visible";
									setSwitchStatus("OSDTimeAndDateCheckSwitch", 0);
									if(OSDsContentsServiceData.ContentList[0].ContentInfo[0].ContentType == 2) { // 第一个区域第一条OSD是时间日期
										/**            初始化 OSD日期时间配置              **/
										showOSDTimeAndDate = OSDsContentsServiceData.ContentList[IPCPosition].Enabled;
										//初始化 OSD日期时间显示开关
										OSDTimeAndDateCheckConfirm = false;
										setSwitchStatus("OSDTimeAndDateCheckSwitch", showOSDTimeAndDate);
										OSDTimeAndDateCheckConfirm = true;
										//若显示OSD日期时间开启则显示配置选项并初始化
										if(showOSDTimeAndDate == 1) {
											//显示 OSD日期时间 配置选项
											mui("#OSDTimeAndDateCheck .mui-table-view-cell").each(function(index, El) {
												if(index != 0) {
													El.classList.remove('mui-hidden');
												}
											});
										}
										//初始化 OSD日期时间 位置
										var TimeX = OSDsContentsServiceData.ContentList[IPCPosition].Area.TopLeft.X;
										var TimeY = OSDsContentsServiceData.ContentList[IPCPosition].Area.TopLeft.Y;
										OSDTimeAndDateSiteVal = selectArea(TimeX, TimeY);
										document.getElementById('OSDTimeAndDateSiteVal').innerText = OSDTimeAndDateSiteVal;
										mui('#OSDTimeAndDateSiteList a').each(function(index, El) {
											if(El.innerText.trim() == OSDTimeAndDateSiteVal) {
												El.parentNode.classList.add('mui-selected');
											}
										});

										// 初始化 OSD时间格式
										if(OSDsStyleServiceData.TimeFormat == 2 || OSDsStyleServiceData.TimeFormat == 0) {
											timeFrameIndex = OSDsStyleServiceData.TimeFormat;
											OSDTimeFormatChecked = selectFormat("Time", timeFrameIndex);
											document.getElementById("OSDTimeFormatFrameVal").innerHTML = OSDTimeFormatChecked;
											mui('#OSDTimeFormatList a').each(function(index, El) {
												if(El.innerText.trim() == OSDTimeFormatChecked) {
													El.parentNode.classList.add('mui-selected');
												}
											});
										} else {
											document.getElementById("OSDTimeFormatFrameVal").innerHTML = "";
										}

										// 初始化 OSD日期格式
										if((langType == "zh" && (OSDsStyleServiceData.DateFormat == 0 ||
												OSDsStyleServiceData.DateFormat == 2 ||
												OSDsStyleServiceData.DateFormat == 4)) ||
											(langType != "zh" && (OSDsStyleServiceData.DateFormat == 101 ||
												OSDsStyleServiceData.DateFormat == 106))) {
											dateFrameIndex = OSDsStyleServiceData.DateFormat;
											OSDDateFormatChecked = selectFormat("Date", dateFrameIndex);
											document.getElementById("OSDDateFormatFrameVal").innerHTML = OSDDateFormatChecked;
											mui('#OSDDateFormatList a').each(function(index, El) {
												if(El.innerText.trim() == OSDDateFormatChecked) {
													El.parentNode.classList.add('mui-selected');
												}
											});
										} else {
											document.getElementById("OSDDateFormatFrameVal").innerHTML = "";
										}
									}
								} else { // NVR下通道
									IPCPosition = 1;
									/**            初始化 OSD通道名称配置              **/
									showChannelName = OSDsContentsServiceData.ContentList[0].Enabled;
									//初始化显示通道名称开关
									document.getElementById("ChannelNameCheckSwitch").style.zIndex = 20;
									document.getElementById("ChannelNameCheckSwitch").style.visibility = "visible";
									ChannelNameCheckConfirm = false;
									setSwitchStatus("ChannelNameCheckSwitch", showChannelName);
									ChannelNameCheckConfirm = true;
									//若显示通道名称开启则显示配置选项并初始化
									if(showChannelName == 1) {
										//显示 OSD通道名称 配置选项
										mui("#ChannelNameCheck .mui-table-view-cell").each(function(index, El) {
											if(index != 0) {
												El.classList.remove('mui-hidden');
											}
										});
									}
									// 初始化 通道名称位置
									var ChannelX = OSDsContentsServiceData.ContentList[0].Area.TopLeft.X;
									var ChannelY = OSDsContentsServiceData.ContentList[0].Area.TopLeft.Y;
									channelNameSiteVal = selectArea(ChannelX, ChannelY);
									document.getElementById('channelNameSiteVal').innerText = channelNameSiteVal;
									channelNameSiteChecked = channelNameSiteVal;
									mui('#channelNameSiteList a').each(function(index, El) {
										if(El.innerText.trim() == channelNameSiteChecked) {
											El.parentNode.classList.add('mui-selected');
										}
									});
									/**            初始化 OSD日期时间配置              **/
									showOSDTimeAndDate = OSDsContentsServiceData.ContentList[IPCPosition].Enabled;
									//初始化 OSD日期时间显示开关
									document.getElementById("OSDTimeAndDateCheckSwitch").style.zIndex = 20;
									document.getElementById("OSDTimeAndDateCheckSwitch").style.visibility = "visible";
									OSDTimeAndDateCheckConfirm = false;
									setSwitchStatus("OSDTimeAndDateCheckSwitch", showOSDTimeAndDate);
									OSDTimeAndDateCheckConfirm = true;
									//若显示OSD日期时间开启则显示配置选项并初始化
									if(showOSDTimeAndDate == 1) {
										//显示 OSD日期时间 配置选项
										mui("#OSDTimeAndDateCheck .mui-table-view-cell").each(function(index, El) {
											if(index != 0) {
												El.classList.remove('mui-hidden');
											}
										});
									}
									//初始化 OSD日期时间 位置
									var TimeX = OSDsContentsServiceData.ContentList[IPCPosition].Area.TopLeft.X;
									var TimeY = OSDsContentsServiceData.ContentList[IPCPosition].Area.TopLeft.Y;
									OSDTimeAndDateSiteVal = selectArea(TimeX, TimeY);
									document.getElementById('OSDTimeAndDateSiteVal').innerText = OSDTimeAndDateSiteVal;
									mui('#OSDTimeAndDateSiteList a').each(function(index, El) {
										if(El.innerText.trim() == OSDTimeAndDateSiteVal) {
											El.parentNode.classList.add('mui-selected');
										}
									});
									// 初始化 OSD时间格式
									if(OSDsStyleServiceData.TimeFormat == 2 || OSDsStyleServiceData.TimeFormat == 0) {
										timeFrameIndex = OSDsStyleServiceData.TimeFormat;
										OSDTimeFormatChecked = selectFormat("Time", timeFrameIndex);
										document.getElementById("OSDTimeFormatFrameVal").innerHTML = OSDTimeFormatChecked;
										mui('#OSDTimeFormatList a').each(function(index, El) {
											if(El.innerText.trim() == OSDTimeFormatChecked) {
												El.parentNode.classList.add('mui-selected');
											}
										});
									} else {
										document.getElementById("OSDTimeFormatFrameVal").innerHTML = "";
									}

									// 初始化 OSD日期格式
									if((langType == "zh" && (OSDsStyleServiceData.DateFormat == 0 ||
											OSDsStyleServiceData.DateFormat == 2 ||
											OSDsStyleServiceData.DateFormat == 4)) ||
										(langType != "zh" && (OSDsStyleServiceData.DateFormat == 101 ||
											OSDsStyleServiceData.DateFormat == 106))) {
										dateFrameIndex = OSDsStyleServiceData.DateFormat;
										OSDDateFormatChecked = selectFormat("Date", dateFrameIndex);
										document.getElementById("OSDDateFormatFrameVal").innerHTML = OSDDateFormatChecked;
										mui('#OSDDateFormatList a').each(function(index, El) {
											if(El.innerText.trim() == OSDDateFormatChecked) {
												El.parentNode.classList.add('mui-selected');
											}
										});
									} else {
										document.getElementById("OSDDateFormatFrameVal").innerHTML = "";
									}
								}
								dsBridgeFuncSyn.dismiss();
							} else {
								//数据获取失败的处理
								$("#EZView-content div.loadFailed").removeClass("mui-hidden");
								showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
								dsBridgeFuncSyn.dismiss();
							}
						})
					} else {
						//数据获取失败的处理
						addBitmap(0);
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				});
			}

			/*
			 * 通道名称显示 使能事件
			 */
			function ChannelNameCheckSwitch(event) {
				if(event.detail.isActive && ChannelNameCheckConfirm) {
					var sendDataON = deepCopy(OSDsContentsServiceData);
					sendDataON.ContentList[0].Enabled = 1;
					OSDsContentsServiceData.ContentList[0].Enabled = 1;
					dsBridgeFuncSyn.showLoading();
					SendAjax(LAPI.OSDsContents, 'put', function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {
							mui("#ChannelNameCheck .mui-table-view-cell").each(function(index, El) {
								if(index != 0) {
									El.classList.remove('mui-hidden');
								}
							});
						} else {
							ChannelNameCheckConfirm = false;
							showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
							setTimeout(function() {
								mui("#ChannelNameCheckSwitch").switch().toggle();
							}, 200);
						}
					}, sendDataON);
				} else if(!event.detail.isActive && ChannelNameCheckConfirm) {
					mui("#ChannelNameCheck .mui-table-view-cell").each(function(index, El) {
						if(index != 0) {
							El.classList.add('mui-hidden');
						}
					});
					var sendDataOFF = deepCopy(OSDsContentsServiceData);
					sendDataOFF.ContentList[0].Enabled = 0;
					OSDsContentsServiceData.ContentList[0].Enabled = 0;
					dsBridgeFuncSyn.showLoading();
					SendAjax(LAPI.OSDsContents, 'put', function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {

						} else {
							ChannelNameCheckConfirm = false;
							showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
							setTimeout(function() {
								mui("#ChannelNameCheckSwitch").switch().toggle();
								mui("#ChannelNameCheck .mui-table-view-cell").each(function(index, El) {
									if(index != 0) {
										El.classList.remove('mui-hidden');
									}
								});
							}, 300);
						}
					}, sendDataOFF);
				} else {
					ChannelNameCheckConfirm = true;
				}
			}

			/*
			 * 日期时间显示 使能事件
			 */
			function OSDTimeAndDateCheckSwitch(event) {
				var code = 0;
				if(event.detail.isActive && OSDTimeAndDateCheckConfirm) {
					var sendDataON = deepCopy(OSDsContentsServiceData);
					if(!(localStorage.deviceType == "1" && localStorage.channelId != "0")) {
						sendDataON.ContentList[0].Enabled = 1;
						OSDsContentsServiceData.ContentList[0].Enabled = 1;
					} else {
						sendDataON.ContentList[1].Enabled = 1;
						OSDsContentsServiceData.ContentList[1].Enabled = 1;
					}
					dsBridgeFuncSyn.showLoading();
					SendAjax(LAPI.OSDsContents, 'put', function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {
							mui("#OSDTimeAndDateCheck .mui-table-view-cell").each(function(index, El) {
								if(index != 0) {
									El.classList.remove('mui-hidden');
								}
							});
						} else {
							OSDTimeAndDateCheckConfirm = false;
							showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
							setTimeout(function() {
								mui("#OSDTimeAndDateCheckSwitch").switch().toggle();
							}, 200);
						}
					}, sendDataON);

				} else if(!event.detail.isActive && OSDTimeAndDateCheckConfirm) {
					mui("#OSDTimeAndDateCheck .mui-table-view-cell").each(function(index, El) {
						if(index != 0) {
							El.classList.add('mui-hidden');
						}
					});
					var sendDataOFF = deepCopy(OSDsContentsServiceData);
					if(!(localStorage.deviceType == "1" && localStorage.channelId != "0")) {
						sendDataOFF.ContentList[0].Enabled = 0;
						OSDsContentsServiceData.ContentList[0].Enabled = 0;
					} else {
						sendDataOFF.ContentList[1].Enabled = 0;
						OSDsContentsServiceData.ContentList[1].Enabled = 0;
					}

					dsBridgeFuncSyn.showLoading();
					SendAjax(LAPI.OSDsContents, 'put', function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {

						} else {
							OSDTimeAndDateCheckConfirm = false;
							showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
							setTimeout(function() {
								mui("#OSDTimeAndDateCheckSwitch").switch().toggle();
								mui("#OSDTimeAndDateCheck .mui-table-view-cell").each(function(index, El) {
									if(index != 0) {
										El.classList.remove('mui-hidden');
									}
								});
							}, 300);
						}
					}, sendDataOFF);
				} else {
					OSDTimeAndDateCheckConfirm = true;
				}
			}

			/*
			 * 关闭 通道名称位置 弹出框
			 */
			function closeChannelNameSiteList() {
				mui('#channelNameSite').popover('toggle');
				if(channelNameSiteChecked == document.getElementById('channelNameSiteVal').innerText.trim()) return;
				mui('#channelNameSiteList a').each(function(index, El) {
					if(El.innerText.trim() == document.getElementById('channelNameSiteVal').innerText.trim()) {
						El.parentNode.classList.add('mui-selected');
					} else {
						El.parentNode.classList.remove('mui-selected');
					}
				});
			}

			/*
			 * 关闭 OSD时间日期位置 弹出框
			 */
			function closeOSDTimeAndDateSiteList() {
				mui('#OSDTimeAndDateSite').popover('toggle');
				if(OSDTimeAndDateSiteVal == document.getElementById('OSDTimeAndDateSiteVal').innerText.trim()) return;
				mui('#OSDTimeAndDateSiteList a').each(function(index, El) {
					if(El.innerText.trim() == document.getElementById('OSDTimeAndDateSiteVal').innerText.trim()) {
						El.parentNode.classList.add('mui-selected');
					} else {
						El.parentNode.classList.remove('mui-selected');
					}
				});
			}

			/*
			 * 关闭 OSD时间格式 弹出框
			 */
			function closeOSDTimeFormat() {
				mui('#OSDTimeFormatFrame').popover('toggle');
				if(OSDTimeFormatChecked == document.getElementById('OSDTimeFormatFrameVal').innerText.trim()) return;
				mui('#OSDTimeFormatList a').each(function(index, El) {
					if(El.innerText.trim() == document.getElementById('OSDTimeFormatFrameVal').innerText.trim()) {
						El.parentNode.classList.add('mui-selected');
					} else {
						El.parentNode.classList.remove('mui-selected');
					}
				});
			}

			/*
			 * 关闭 OSD日期格式 弹出框
			 */
			function closeOSDDateFormat() {
				mui('#OSDDateFormatFrame').popover('toggle');
				if(OSDDateFormatChecked == document.getElementById('OSDDateFormatFrameVal').innerText.trim()) return;
				mui('#OSDDateFormatList a').each(function(index, El) {
					if(El.innerText.trim() == document.getElementById('OSDDateFormatFrameVal').innerText.trim()) {
						El.parentNode.classList.add('mui-selected');
					} else {
						El.parentNode.classList.remove('mui-selected');
					}
				});
			}

			/*
			 * 选择 通道名称位置 
			 */
			function channelNameSiteOk() {
				mui('#channelNameSite').popover('toggle');
				checkArea(AreaData, 0);
				var sendData = deepCopy(OSDsContentsServiceData);
				dsBridgeFuncSyn.showLoading();
				SendAjax(LAPI.OSDsContents, 'put', function(code, data) {
					dsBridgeFuncSyn.dismiss();
					if(code == 0) {
						OSDsContentsServiceData = deepCopy(sendData);
						OSDsContentsServiceDataMap = deepCopy(OSDsContentsServiceData);
						document.getElementById('channelNameSiteVal').innerText = channelNameSiteChecked;
					} else {
						OSDsContentsServiceData = deepCopy(OSDsContentsServiceDataMap); // 下发失败，数据初始化
						if(channelNameSiteChecked != document.getElementById('channelNameSiteVal').innerText.trim()) {
							mui('#channelNameSiteList a').each(function(index, El) {
								if(El.innerText.trim() == document.getElementById('channelNameSiteVal').innerText.trim()) {
									El.parentNode.classList.add('mui-selected');
								} else {
									El.parentNode.classList.remove('mui-selected');
								}
							});
						}
						showToast(langTip["WEB_toast_modify_favoritesname_failed"] + "(" + code + ")", code);
					}
				}, sendData);
			}

			/*
			 * 选择 OSD时间日期 位置 
			 */
			function OSDTimeAndDateSiteOk() {
				mui('#OSDTimeAndDateSite').popover('toggle');
				if(!(localStorage.deviceType == "1" && localStorage.channelId != "0")) {
					checkArea(AreaData, 0);
					//直连IPC时，此处默认配置区域2的第一条OSD为时间日期
					OSDsContentsServiceData.ContentList[0].ContentInfo[0].ContentType = 2;
					OSDsContentsServiceData.ContentList[0].ContentInfo[0].Value = "";
				} else {
					checkArea(AreaData, 1);
				}

				var sendData = deepCopy(OSDsContentsServiceData);
				dsBridgeFuncSyn.showLoading();
				SendAjax(LAPI.OSDsContents, 'put', function(code, data) {
					dsBridgeFuncSyn.dismiss();
					if(code == 0) {
						OSDsContentsServiceData = deepCopy(sendData);
						OSDsContentsServiceDataMap = deepCopy(OSDsContentsServiceData);
						document.getElementById('OSDTimeAndDateSiteVal').innerText = OSDTimeAndDateSiteVal;
					} else {
						OSDsContentsServiceData = deepCopy(OSDsContentsServiceDataMap); // 下发失败，数据初始化
						if(OSDTimeAndDateSiteVal != document.getElementById('OSDTimeAndDateSiteVal').innerText.trim()) {
							mui('#OSDTimeAndDateSiteList a').each(function(index, El) {
								if(El.innerText.trim() == document.getElementById('OSDTimeAndDateSiteVal').innerText.trim()) {
									El.parentNode.classList.add('mui-selected');
								} else {
									El.parentNode.classList.remove('mui-selected');
								}
							});
						}
						showToast(langTip["WEB_toast_modify_favoritesname_failed"] + "(" + code + ")", code);
					}
				}, sendData);
			}

			/*
			 * 选择 OSD时间格式 
			 */
			function OSDTimeFormatOk() {
				mui('#OSDTimeFormatFrame').popover('toggle');
				OSDsStyleServiceData.TimeFormat = Number(timeFrameIndex);
				var sendData = deepCopy(OSDsStyleServiceData);
				dsBridgeFuncSyn.showLoading();
				SendAjax(LAPI.OSDStyle, 'put', function(code, data) {
					dsBridgeFuncSyn.dismiss();
					if(code == 0) {
						OSDsStyleServiceData = deepCopy(sendData);
						OSDsStyleServiceDataMap = deepCopy(OSDsStyleServiceData);
						OSDTimeFormatChecked = selectFormat("Time", timeFrameIndex);
						document.getElementById('OSDTimeFormatFrameVal').innerText = OSDTimeFormatChecked;
					} else {
						OSDsStyleServiceData = deepCopy(OSDsStyleServiceDataMap); // 下发失败，数据初始化
						if(OSDTimeFormatChecked != document.getElementById('OSDTimeFormatFrameVal').innerText.trim()) {
							mui('#OSDTimeFormatFrame a').each(function(index, El) {
								if(El.innerText.trim() == document.getElementById('OSDTimeFormatFrameVal').innerText.trim()) {
									El.parentNode.classList.add('mui-selected');
								} else {
									El.parentNode.classList.remove('mui-selected');
								}
							});
						}
						showToast(langTip["WEB_toast_modify_favoritesname_failed"] + "(" + code + ")", code);
					}
				}, sendData);
			}

			/*
			 * 选择 OSD日期格式 
			 */
			function OSDDateFormatOk() {
				mui('#OSDDateFormatFrame').popover('toggle');
				OSDsStyleServiceData.DateFormat = Number(dateFrameIndex);
				var sendData = deepCopy(OSDsStyleServiceData);
				dsBridgeFuncSyn.showLoading();
				SendAjax(LAPI.OSDStyle, 'put', function(code, data) {
					dsBridgeFuncSyn.dismiss();
					if(code == 0) {
						OSDsStyleServiceData = deepCopy(sendData);
						OSDsStyleServiceDataMap = deepCopy(OSDsStyleServiceData);
						OSDDateFormatChecked = selectFormat("Date", dateFrameIndex);
						document.getElementById('OSDDateFormatFrameVal').innerText = OSDDateFormatChecked;
					} else {
						OSDsStyleServiceData = deepCopy(OSDsStyleServiceDataMap); // 下发失败，数据初始化
						if(OSDDateFormatChecked != document.getElementById('OSDDateFormatFrameVal').innerText.trim()) {
							mui('#OSDDateFormatFrame a').each(function(index, El) {
								if(El.innerText.trim() == document.getElementById('OSDDateFormatFrameVal').innerText.trim()) {
									El.parentNode.classList.add('mui-selected');
								} else {
									El.parentNode.classList.remove('mui-selected');
								}
							});
						}
						showToast(langTip["WEB_toast_modify_favoritesname_failed"] + "(" + code + ")", code);
					}
				}, sendData);
			}

			function selectArea(x, y) {
				if(x < 5000 && y < 5000) {
					return langTip["WEB_area_top_left"];
				} else if(x < 5000 && y >= 5000) {
					return langTip["WEB_area_bottom_left"];
				} else if(x >= 5000 && y >= 5000) {
					return langTip["WEB_area_bottom_right"];
				} else {
					return langTip["WEB_area_top_right"];
				}
			}

			function checkArea(data, i) {
				if(data == "AreaTopLeft") {
					OSDsContentsServiceData.ContentList[i].Area.TopLeft.X = 100;
					OSDsContentsServiceData.ContentList[i].Area.TopLeft.Y = 100;
				} else if(data == "AreaTopRight") {
					OSDsContentsServiceData.ContentList[i].Area.TopLeft.X = 8000;
					OSDsContentsServiceData.ContentList[i].Area.TopLeft.Y = 100;
				} else if(data == "AreaBottomRight") {
					OSDsContentsServiceData.ContentList[i].Area.TopLeft.X = 8000;
					OSDsContentsServiceData.ContentList[i].Area.TopLeft.Y = 9900;
				} else {
					OSDsContentsServiceData.ContentList[i].Area.TopLeft.X = 100;
					OSDsContentsServiceData.ContentList[i].Area.TopLeft.Y = 9900;
				}
			}

			function selectFormat(type, index) {
				if(type == "Time") {
					switch(Number(index)) {
						case 0:
							return "HH:mm:ss";
							break;
						case 2:
							return "hh:mm:ss tt";
							break;
						default:
							break;
					}
				} else if(type == "Date") {
					switch(Number(index)) {
						case 0:
							return "yyyy-MM-dd";
							break;
						case 2:
							return "yyyy年MM月dd日";
							break;
						case 4:
							return "yyyy年MM月dd日星期X";
							break;
						case 101:
							return "MM/dd/yyyy";
							break;
						case 106:
							return "yyyy/MM/dd";
							break;
						default:
							break;
					}
				}
			}
		</script>
	</body>

</html>