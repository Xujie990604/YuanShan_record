<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<title></title>
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/iconfont.css" rel="stylesheet" />
		<link href="../css/Common.css" rel="stylesheet" />
		<link href="../css/theme_normal.css" rel="stylesheet" />
		<style>
			/*日夜模式*/
			
			html,
			body,
			.mui-bar-nav~.mui-content {
				height: 100%;
			}
			
			.mui-radio input[type='radio']:before,
			.mui-checkbox input[type='checkbox']:before {
				font-size: 22px;
			}
			
			#Nosupport-content {
				position: relative;
			}
			
			.ui-placeholder-full {
				width: 100%;
				height: 100%;
				position: absolute;
				top: 0;
				left: 0;
				background: #ffffff;
			}
			
			.ui-placeholder-imgbox1 p {
				font-family: simhei;
				text-align: center;
				margin-top: 5px;
				color: #666666;
			}
			
			.ui-placeholder-imgbox1 .ui-p1 {
				text-align: center;
				position: relative;
			}
			
			#try_reset {
				color: #50D0C1;
			}
			
			.ui-placeholder-imgbox1 {
				padding: 50px 20px 0px 20px;
			}
			
			.ui-placeholder-imgbox1 img {
				width: 100%;
			}
			
			.SupportLoading span {
				display: inline-block;
			}
			
			.SupportLoading span:last-child {
				color: #50D0C1;
				z-index: 10;
				right: 17px;
			}
			
			#dayLightAlarmItem0,
			#dayAudioAlarmItem0 {
				padding-left: 30px;
			}
			
			#LinkageTypeItem {
				display: flex;
				align-items: center;
			}
			
			.mui-radio input[type='radio'],
			.mui-checkbox input[type='checkbox'] {
				top: -1px;
			}
			
			.mui-table-view-cell .ui-tip {
				position: absolute;
				right: 5px;
				top: 20px;
				z-index: 100;
			}
			
			#SDSettingUl .mui-table-view-cell:not(:first-child) a {
				padding-left: 30px;
			}
			
			.installType {
				text-align: left;
				background-color: #fff;
				height: 48px;
			}
			
			.mui-table-view-radio .mui-table-view-cell .mui-navigate-right:after {
				color: #50D0C1;
			}
			
			.ui-siwtchlist .mui-table-view-cell:not(:first-child) a {
				padding-left: 15px;
			}
			
			.selectAudioStepVal,
			.AudioOut {
				padding-left: 30px;
			}
			
			.mui-table-view-cell .ui-tip {
				color: #50D0C1;
			}
			
			.over-text {
				width: 160px;
				white-space: nowrap;
				text-overflow: ellipsis;
				overflow: hidden;
				text-align: right;
			}
			
			.ui-dateok {
				color: #50D0C1;
			}
			/*音量*/
			
			.mui-table-view-cell .ui-tip {
				position: absolute;
				right: 5px;
				top: 20px;
				z-index: 100;
			}
			
			.mui-input-range input[type='range'] {
				position: absolute;
				top: 9px;
				height: 5px;
				margin: 0;
				width: 65%;
				background-color: #c8c7cc;
			}
			
			.mui-input-range .mui-tooltip {
				position: absolute;
				left: inherit !important;
				right: 0px;
				font-size: 16px;
				top: -5px;
				width: 30px;
				height: 30px;
				line-height: 30px;
				color: #707070;
				border: none;
				display: block !important;
			}
			
			.rangeTitle {
				display: inline-block;
				height: 22px;
				width: 22%;
				line-height: 22px;
				top: 0;
				left: 15px;
			}
			
			#AudioOut0,
			#AudioOut1,
			#AudioOut2 {
				overflow: inherit !important;
			}
			
			.mui-radio label {
				padding: 0;
				padding-left: 45px !important;
				padding-right: 0 !important;
			}
			
			.LinkageTypeItem mui-left:first-child {
				margin-left: 30px;
			}
			
			.custom-tip-font {
				font-size: 12px;
				color: #999999;
				text-align: center;
				padding: 0px 30px;
				margin: 16px 0px 20px 0px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="back" class="mui-action-back mui-icon iconfont icon-back1"></a>
			<h1 id="title" class="mui-title" data-text="WEB_Alarm_plan">&nbsp;</h1>
			<a id="save" class="mui-icon iconfont icon-save mui-pull-right mui-hidden"></a>
		</header>
		<div class="mui-content">
			<div id="EZView-content" class="mui-hidden">
				<ul id="PlanCheck0" class="mui-table-view ui-siwtchlist">
					<li class="mui-table-view-cell">
						<span data-text="WEB_plan1">&nbsp;</span>
					</li>
					<li id="StarTimeItem0" data-type="0" class="mui-table-view-cell StarTimeItem">
						<a id="StarTimeArea0" class="mui-navigate-right">
							<span id="TimeStepVal0" class="mui-badge ">00:00:00-00:00:00</span>
							<span data-text="WEB_start_end_time">&nbsp;</span>
						</a>
					</li>
					<li id="LightAlarmItem0" data-id="0" class="mui-table-view-cell">
						<span data-text="WEB_light_alarm">&nbsp;</span>
						<div id="LightAlarmSwitch0" data-type="0" class="mui-switch mui-switch-mini LightAlarmSwitch">
							<div class="mui-switch-handle" id="LightAlarmCircle0"></div>
						</div>
					</li>
					<li id="AudioAlarmItem0" class="mui-table-view-cell">
						<span data-text="WEB_audio_alarm">&nbsp;</span>
						<div id="AudioAlarmSwitch0" data-type="0" class="mui-switch mui-switch-mini AudioAlarmSwitch">
							<div class="mui-switch-handle" id="AudioAlarmCircle0"></div>
						</div>
					</li>
					<li id="selectAudioItem0" data-type="0" class="mui-table-view-cell selectAudioStepVal  mui-hidden">
						<a class="mui-navigate-right">
							<span id="selectAudioStepVal0" class="mui-badge over-text"></span>
							<span data-text="WEB_alarm_audio_selected">&nbsp;</span>
						</a>
					</li>
				</ul>
				<ul id="PlanCheck1" class="mui-table-view ui-siwtchlist">
					<li class="mui-table-view-cell">
						<span data-text="WEB_plan2">&nbsp;</span>
					</li>
					<li id="StarTimeItem1" data-type="1" class="mui-table-view-cell StarTimeItem">
						<a id="StarTimeArea1" class="mui-navigate-right">
							<span id="TimeStepVal1" class="mui-badge ">00:00:00-00:00:00</span>
							<span data-text="WEB_start_end_time">&nbsp;</span>
						</a>
					</li>
					<li id="LightAlarmItem1" data-id="1" class="mui-table-view-cell">
						<span data-text="WEB_light_alarm">&nbsp;</span>
						<div id="LightAlarmSwitch1" data-type="1" class="mui-switch mui-switch-mini LightAlarmSwitch">
							<div class="mui-switch-handle" id="LightAlarmCircle1"></div>
						</div>
					</li>
					<li id="AudioAlarmItem1" class="mui-table-view-cell">
						<span data-text="WEB_audio_alarm">&nbsp;</span>
						<div id="AudioAlarmSwitch1" data-type="1" class="mui-switch mui-switch-mini AudioAlarmSwitch">
							<div class="mui-switch-handle" id="AudioAlarmCircle1"></div>
						</div>
					</li>
					<li id="selectAudioItem1" data-type="1" class="mui-table-view-cell selectAudioStepVal mui-hidden">
						<a class="mui-navigate-right">
							<span id="selectAudioStepVal1" class="mui-badge over-text"></span>
							<span data-text="WEB_alarm_audio_selected">&nbsp;</span>
						</a>
					</li>
				</ul>
				<ul id="PlanCheck2" class="mui-table-view ui-siwtchlist">
					<li class="mui-table-view-cell">
						<span data-text="WEB_plan3">&nbsp;</span>
					</li>
					<li id="StarTimeItem2" data-type="2" class="mui-table-view-cell StarTimeItem">
						<a id="StarTimeArea2" class="mui-navigate-right">
							<span id="TimeStepVal2" class="mui-badge ">00:00:00-00:00:00</span>
							<span data-text="WEB_start_end_time">&nbsp;</span>
						</a>
					</li>
					<li id="LightAlarmItem2" data-id="2" class="mui-table-view-cell">
						<span data-text="WEB_light_alarm">&nbsp;</span>
						<div id="LightAlarmSwitch2" data-type="2" class="mui-switch mui-switch-mini LightAlarmSwitch">
							<div class="mui-switch-handle" id="LightAlarmCircle2"></div>
						</div>
					</li>
					<li id="AudioAlarmItem2" class="mui-table-view-cell">
						<span data-text="WEB_audio_alarm">&nbsp;</span>
						<div id="AudioAlarmSwitch2" data-type="2" class="mui-switch mui-switch-mini AudioAlarmSwitch">
							<div class="mui-switch-handle" id="AudioAlarmCircle2"></div>
						</div>
					</li>
					<li id="selectAudioItem2" data-type="2" class="mui-table-view-cell selectAudioStepVal mui-hidden">
						<a class="mui-navigate-right">
							<span id="selectAudioStepVal2" class="mui-badge over-text"></span>
							<span data-text="WEB_alarm_audio_selected">&nbsp;</span>
						</a>
					</li>
				</ul>
			</div>
			<div id="deepAlarmTip" class="custom-tip-font mui-hidden" data-text="WEB_deepAlarmTip">
				&nbsp;
			</div>
		</div>
		<div id="selectAudio" class="mui-popover mui-popover-action mui-popover-bottom ui-radio-list">
			<form class="mui-input-group">
				<div class="mui-input-row mui-checkbox ui-list-titile">
					<label data-text="WEB_alarm_audio_selected">&nbsp;</label>
					<span id="closeAudioList" class="mui-icon mui-icon-closeempty"></span>
				</div>
				<div id="selectAudioListItem" class="ui-list-container">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul id="selectAudioList" class="mui-table-view mui-table-view-radio">
							</ul>
						</div>
					</div>
				</div>
			</form>
			<button id="selectAudioListOk" class="mui-btn mui-btn-block ui-dateok" data-text="WEB_button_ok">&nbsp;</button>
		</div>

		<script src="../js/dsbridge.min.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/libs/md5.js"></script>
		<script src="../js/libs/jquery-3.4.1.min.js"></script>
		<script src="../js/libs/sha2.js"></script>
		<script src="../js/resource.js"></script>
		<script src="../js/Utils.js"></script>
		<script src="../js/mui.js"></script>
		<script src="../js/immersed.js"></script>
		<script src="../js/customSetting.js"></script>
		<script src="../js/loadCss.js "></script>
    <script id="langScript"></script>
		<script>
			var langTip;
			var self;
			var AlarmLAPI;
			checkType(localStorage.AppType); //加载特定样式
			var CheckTimeServiceData = {}; //获取报警联动计划信息
			var AlarmAudioList; //报警音选择列表
			var AudioChecked = 0; //灯光告警是否选中
			var AudioCheckedID = 0; //灯光告警选中ID
			var AudioCheckedarr = []; //报警音选择列表名称
			var AudioFile; //报警音接口
			var date = { //初始化起止时间
				startHour: 0,
				startMin: 0,
				startSec: 0,
				endHour: 0,
				endMin: 0,
				endSec: 0
			};
			var startArr = [],
				endArr = [],
				infoValue = [], //存放报警对象
				lightIsOpen = 0, //0位灯光告警关闭
				audioIsOpen = 0, //0位声音告警关闭
				rangeVal;
			var StarTimeItem = document.querySelectorAll(".StarTimeItem");

			var AudioTimeSectionInfo = {
				Enabled: 0,
				Begin: "00:00:00",
				End: "00:00:00",
				AudioActParamInfo: {
					AudioFileID: 0,
					WarnCount: 3,
					AudioVolume: 255
				}
			};
			var LightTimeSectionInfo = {
				Enabled: 0,
				Begin: "00:00:00",
				End: "00:00:00"
			};
			var Day = {
				ID: -1,
				Num: 0,
				TimeSectionInfos: []
			};
			var configData = {
				Num: 2,
				Actions: [{
					Enabled: 1,
					ActID: 28,
					ActParam: {
						TimeMode: 0,
						AudioCustomInfo: {
							Num: 7,
							Days: []
						}
					}
				}, {
					Enabled: 1,
					ActID: 29,
					ActParam: {
						TimeMode: 0,
						LightCustomInfo: {
							LightActParamInfo: {
								Interval: 10,
								Luminance: 50
							},
							LightWeekPlanInfo: {
								Num: 7,
								Days: []
							}
						}
					}
				}]
			};
			checkType(localStorage.AppType); //加载特定样式
			mui.init();
			var typeLan = initLang();
			langTip = typeLan.lang;
			initPage();
			initData();
			initEvent();

			function initPage() {

			}

			function initData() {
				var Url = "web/newPages/settings_DeepAlarm.html";
				var self = dsBridgeFuncSyn.getWebParam(Url);
				self = JSON.parse(self);
				var AlarmType = self.AlarmType;
				switch(AlarmType) {
					case 0:
						AlarmLAPI = LAPI.CrossLineDetectionLinkageActions;
						break;
					case 1:
						AlarmLAPI = LAPI.IntrusionDetectionLinkageActions;
						break;
					case 2:
						AlarmLAPI = LAPI.LeaveZoneLinkageActions;
						break;
					case 3:
						AlarmLAPI = LAPI.AccessZoneLinkageActions;
						break;
					case 4:
					//门磁报警联动计划
						AlarmLAPI = LAPI.customLinkageAction;
						break;
					case 5:
						AlarmLAPI = LAPI.MotionDetectionLinkageActions.replace(/<Mode>/, 1);
						break;
					default:
						break;
				}
				if(localStorage.deviceType == "0" &&localStorage.isMultiChannelIPC == "0") {
					AudioFile = LAPI.AudioFile.replace("<ID>", -1);
				} else {
					AudioFile = LAPI.AudioFile;
				}
				initPlanCheckSwitch(); //初始化联动计划
				mui('.mui-scroll-wrapper').scroll();
			}

			function initEvent() {
				document.getElementById('selectAudioList').addEventListener('selected', function(e) { //报警音列表选择
					AudioChecked = e.detail.el.innerText.trim();
					AudioCheckedID = Number(e.detail.el.children[0].getAttribute("data-id"));
				});
				document.getElementById('selectAudioListOk').addEventListener('tap', selectAudioListOk); //报警音确定
				document.getElementById('closeAudioList').addEventListener('tap', closeAudioList); //报警音取消
				document.getElementById('save').addEventListener('tap', function() {
					if(localStorage.deviceType == "0") {
						save();
					} else {
						savachl();
					}
				}); //报警音确定
				StarTimeItem.forEach(function(v) { // 获取检测时间弹框及配置检测时间
					v.addEventListener('tap', function(event) {
						var type = this.getAttribute("data-type");
						getTimeFrame(Number(type));
					})
				});
				document.querySelectorAll(".LightAlarmSwitch").forEach(function(v) { // 灯光报警按钮切换
					v.addEventListener('toggle', function(event) {
						var type = event.target.getAttribute("data-type");
						LightSwitch(event, type);
					})
				});
				document.querySelectorAll(".AudioAlarmSwitch").forEach(function(v) { //  声音报警按钮切换
					v.addEventListener('toggle', function(event) {
						var type = event.target.getAttribute("data-type");
						AudioSwitch(event, type);
					})
				});
				document.querySelectorAll(".selectAudioStepVal").forEach(function(v) { // 报警音弹框选择
					v.addEventListener('tap', function(event) {
						var type = this.getAttribute("data-type");
						getSelectedAlarm(event, type);
					})
				});

			}

			/*
			 * 初始化按钮开关
			 */
			function initPlanCheckSwitch() {
				var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
				var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
				for(var z = 1; z < 8; z++) {
					var DayData1 = JSON.parse(JSON.stringify(Day));
					DayData1.ID = z;
					var DayData2 = JSON.parse(JSON.stringify(Day));
					DayData2.ID = z;
					for(var m = 0; m < 3; m++) {
						var TimeSectionInfosData1 = JSON.parse(JSON.stringify(AudioTimeSectionInfo));
						var TimeSectionInfosData2 = JSON.parse(JSON.stringify(LightTimeSectionInfo));
						DayData1.Num++;
						DayData2.Num++;
						DayData1.TimeSectionInfos.push(TimeSectionInfosData1);
						DayData2.TimeSectionInfos.push(TimeSectionInfosData2);
					}
					AudioInfo.Days.push(DayData1);
					LightInfo.LightWeekPlanInfo.Days.push(DayData2);
				}
				var czqArg = JSON.stringify(configData);
				for(var i = 0; i < 3; i++) {
					getLightAlarm(0, i)
					getAudioAlarm(0, i)
					document.getElementById("LightAlarmSwitch" + i).style.zIndex = 20;
					document.getElementById("LightAlarmSwitch" + i).style.visibility = "visible";
					document.getElementById("AudioAlarmSwitch" + i).style.zIndex = 20;
					document.getElementById("AudioAlarmSwitch" + i).style.visibility = "visible";
				}
				initAlarmAudio();

			}

			/**
			 * 报警音列表初始化
			 */
			function initAlarmAudio() {
				SendAjax(AudioFile, 'get', function(code, data) {
					dsBridgeFuncSyn.dismiss();
					if(code == 0) {
						$("#EZView-content").removeClass("mui-hidden");
						$("#deepAlarmTip").removeClass("mui-hidden");
						$("#save").removeClass("mui-hidden");
						AlarmAudioList = data.FileInfoList;
						AudioChecked = AlarmAudioList[0].FileName;
						for(var i = 0; i < 3; i++) {
							document.getElementById('selectAudioStepVal' + i).innerText = AlarmAudioList[0].FileName;
							AudioCheckedarr[i] = AudioChecked;
						}
						getAudioAlarmList(AlarmAudioList);
						mui('#selectAudioList a').each(function(index, El) {
							if(El.innerText.trim() == AudioChecked) {
								El.parentNode.classList.add('mui-selected');
							}
						});
					} else {
						addBitmap(0);
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				})
			}

			/**
			 * 报警音选择弹框
			 * @param {Object} event
			 * @param {Object} type
			 */
			function getSelectedAlarm(event, type) {
				if(event.target.getAttribute("type") == "button") { //报警音选择为请点击刷新时不显示弹框
					return;
				}
				mui('#selectAudio').popover('toggle');
				document.getElementById("selectAudio").setAttribute("data-id", type);
				for(var i = 0; i < 3; i++) {
					if(i == type) {
						mui('#selectAudioList a').each(function(index, El) {
							El.parentNode.classList.remove('mui-selected');
							if(El.innerText.trim() == AudioCheckedarr[i]) {
								El.parentNode.classList.add('mui-selected');
							}
						});
					}
				}
			}

			/*
			 * 获取告警音列表
			 */
			function getAudioAlarmList(data) { // 报警音列表在页面中显示
				var selectAudioListItem = document.getElementById('selectAudioListItem');
				if(data.length <= 5) {
					selectAudioListItem.style.height = 50 * data.length + "px";
				} else {
					selectAudioListItem.style.height = 50 * 5 + "px";
				}
				var selectAudioList = document.getElementById('selectAudioList');
				for(var i = 0; i < data.length; i++) {
					var item = document.createElement('li');
					item.className = 'mui-table-view-cell installType';
					item.innerHTML = '<a class="mui-navigate-right" data-id=' + data[i].ID + ' data-value=' + i + '>&nbsp;' + data[i].FileName + '</a>';
					selectAudioList.appendChild(item);
				}
			}

			/**
			 * 灯光报警显示开启或关闭
			 * @param {Object} value
			 * @param {Object} i
			 */
			function getLightAlarm(value, i) {
				setSwitchStatus("LightAlarmSwitch" + i, value);
				if(document.getElementById("LightAlarmSwitch" + i).classList.contains("mui-active")) {
					document.getElementById("LightAlarmCircle" + i).style.transform = 'translate(16px, 0px)';
				}
			}

			/**
			 * 声音报警显示开启或关闭
			 * @param {Object} value
			 * @param {Object} i
			 */
			function getAudioAlarm(value, i) {
				setSwitchStatus("AudioAlarmSwitch" + i, value);
				if(document.getElementById("AudioAlarmSwitch" + i).classList.contains("mui-active")) {
					document.getElementById("AudioAlarmCircle" + i).style.transform = 'translate(16px, 0px)';
				}
			}

			function add0(num) {
				var str = "";
				if(num < 10) {
					str = str + "0" + num;
				} else {
					str = str + num;
				}
				return str;
			}

			/**
			 * 检测时间
			 * @param {Object} type
			 */
			function getTimeFrame(type) {
				StarTimeItem.forEach(function(v) { // 获取起止时间
					if(type == v.getAttribute("data-type")) {
						var startType = v.children["StarTimeArea" + type].children["TimeStepVal" + type].innerText.split("-")[0];
						var endType = v.children["StarTimeArea" + type].children["TimeStepVal" + type].innerText.split("-")[1];
						date = transterTime(startType, endType);
					}
				});
				if(date.startHour == "24" && date.startMin == "00" && date.startSec == "00" && //开始时间和结束时间为24:00:00时，改为00:00:00
					date.endHour == "24" && date.endMin == "00" && date.endSec == "00") {
					date = {
						startHour: 0,
						startMin: 0,
						startSec: 0,
						endHour: 0,
						endMin: 0,
						endSec: 0
					}
				}
				dsBridgeFuncAsyn.showDate('hdate', JSON.stringify(date), function(result) {
					var result = JSON.parse(result);
					if(result.statusCode == "1") return;
					var resultObj = JSON.parse(result.param);
					var begin = add0(resultObj.startHour) + ":" + add0(resultObj.startMin) + ":" + add0(resultObj.startSec);
					var end = add0(resultObj.endHour) + ":" + add0(resultObj.endMin) + ":" + add0(resultObj.endSec);
					if(begin == end) {
						showToast(langTip["WEB_dialog_time_edit"]);
						return;
					}
					var isExit = jugdgeTime(begin, end, type); //判断时间是否重叠 false没有重叠，可以设置时间，true无法设置时间
					if(isExit) {
						showToast(langTip["WEB_time_tip"]);
						return;
					}
					var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
					var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
					for(var z = 0; z < 7; z++) {
						AudioInfo.Days[z].TimeSectionInfos[type].Begin = begin;
						AudioInfo.Days[z].TimeSectionInfos[type].End = end;
						LightInfo.LightWeekPlanInfo.Days[z].TimeSectionInfos[type].Begin = begin;
						LightInfo.LightWeekPlanInfo.Days[z].TimeSectionInfos[type].End = end;
					}
					var czqArg = JSON.stringify(configData);
					StarTimeItem.forEach(function(v) {
						if(type == v.getAttribute("data-type")) {
							v.children["StarTimeArea" + type].children["TimeStepVal" + type].innerText = begin + "-" + end;
							startArr[type] = begin;
							endArr[type] = end;
						}
					});
				}, function(result) {;
				});
			}

			/**
			 * 时间赋值
			 * @param {Object} startTime
			 * @param {Object} endTime
			 */
			function transterTime(startTime, endTime) {
				var start = startTime.split(":").map(function(v) {
					return Number(v)
				})
				var end = endTime.split(":").map(function(v) {
					return Number(v)
				})
				date = {
					startHour: start[0],
					startMin: start[1],
					startSec: start[2],
					endHour: end[0],
					endMin: end[1],
					endSec: end[2]
				}
				return date
			}

			/**
			 * 检测时间区段判断
			 * @param {Object} begin
			 * @param {Object} end
			 * @param {Object} type
			 */
			function jugdgeTime(begin, end, type) {
				var s = deepCopy(startArr);
				var e = deepCopy(endArr);
				for(var i = 0; i < 3; i++) {
					if(type == i) {
						s[i] = begin;
						e[i] = end;
					}
				}
				var checkTime = [];
				for(var i = 0; i < s.length; i++) {
					checkTime.push({
						begin: s[i],
						end: e[i]
					})
				}
				var isSame = false;
				var campareList = [];
				for(var j = 0; j < checkTime.length; j++) {
					var beginStramp = new Date('2020/01/01 ' + checkTime[j].begin).getTime();
					var endStramp = new Date('2020/01/01 ' + checkTime[j].end).getTime();
					for(var i = 0; i < campareList.length; i++) {
						if((campareList[i].beginStramp <= beginStramp && beginStramp < campareList[i].endStramp) ||
							(campareList[i].beginStramp < endStramp && endStramp < campareList[i].endStramp) ||
							(beginStramp <= campareList[i].beginStramp && campareList[i].beginStramp < endStramp) ||
							(beginStramp < campareList[i].endStramp && campareList[i].endStramp < endStramp)) {
							isSame = true;
							return true;
							break;
						}
					}
					if(isSame) {
						break;
					}
					campareList.push({
						beginStramp: beginStramp,
						endStramp: endStramp
					});
				}
			}

			/**
			 * 灯光告警按钮
			 * @param {Object} event
			 * @param {Object} type
			 */
			function LightSwitch(event, type) {
				var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
				if(event.detail.isActive) {
					for(var z = 0; z < 7; z++) {
						LightInfo.LightWeekPlanInfo.Days[z].TimeSectionInfos[type].Enabled = 1;
					}
				} else if(!event.detail.isActive) {
					for(var z = 0; z < 7; z++) {
						LightInfo.LightWeekPlanInfo.Days[z].TimeSectionInfos[type].Enabled = 0;
					}
				}
			}

			/**
			 * 声音告警按钮
			 * @param {Object} event
			 * @param {Object} type
			 */
			function AudioSwitch(event, type) {
				var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
				if(event.detail.isActive) {
					for(var z = 0; z < 7; z++) {
						AudioInfo.Days[z].TimeSectionInfos[type].Enabled = 1;
					}
					document.getElementById("selectAudioItem" + type).classList.remove("mui-hidden");
				} else if(!event.detail.isActive) {
					for(var z = 0; z < 7; z++) {
						AudioInfo.Days[z].TimeSectionInfos[type].Enabled = 0;
					}
					document.getElementById("selectAudioItem" + type).classList.add("mui-hidden");
				}
			}

			/**
			 * 报警音确定
			 */
			function selectAudioListOk() {
				mui('#selectAudio').popover('toggle');
				if(!AudioChecked) {
					return;
				}
				var type = document.getElementById("selectAudio").getAttribute("data-id");
				AudioCheckedarr[type] = AudioChecked;
				document.getElementById('selectAudioStepVal' + type).innerText = AudioCheckedarr[type];
				var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
				for(var z = 0; z < 7; z++) {
					AudioInfo.Days[z].TimeSectionInfos[type].AudioActParamInfo.AudioFileID = AudioCheckedID;
				}
			}

			/**
			 * 报警音确定取消
			 */
			function closeAudioList() {
				mui('#selectAudio').popover('toggle');
				for(var i = 0; i < 3; i++) {
					if(AudioChecked == document.getElementById('selectAudioStepVal' + i).innerText.trim()) return;
					mui('#selectAudioList a').each(function(index, El) {
						if(El.innerText.trim() == document.getElementById('selectAudioStepVal' + i).innerText.trim()) {
							El.parentNode.classList.add('mui-selected');
						} else {
							El.parentNode.classList.remove('mui-selected');
						}
					});
				}
			}

			/*
			 * 通道保存报警联动计划
			 */
			function savachl() {
				dsBridgeFuncSyn.showLoading();
				SendAjax(AlarmLAPI, 'get', function(code, data) {
					if(code == 0) {
						var sendData = JSON.parse(JSON.stringify(data));
						var AudioFirst = true;
						var LightFirst = true;
						var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
						var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
						for(var i = 0; i < sendData.Num; i++) {
							if(sendData.Actions[i].ActID == 28) {
								var sendAudioInfo = sendData.Actions[i].ActParam.AudioCustomInfo;
								sendData.Actions[i].Enabled = 1;
								AudioFirst = false;
								sendAudioInfo.Days.Num = 8;
								for(var m = 0; m < 7; m++) {
									var numberOfcycles = sendAudioInfo.Days[m].Num < 3 ? 3 : sendAudioInfo.Days[m].Num;
									var orangeNum = sendAudioInfo.Days[m].Num;
									for(var n = 0; n < numberOfcycles; n++) {
										if(n < 3) {
											if(n < orangeNum) {
												sendAudioInfo.Days[m].TimeSectionInfos[n].AudioActParamInfo.AudioFileID = AudioInfo.Days[m].TimeSectionInfos[n].AudioActParamInfo.AudioFileID;
												sendAudioInfo.Days[m].TimeSectionInfos[n].Enabled = AudioInfo.Days[m].TimeSectionInfos[n].Enabled;
												sendAudioInfo.Days[m].TimeSectionInfos[n].Begin = AudioInfo.Days[m].TimeSectionInfos[n].Begin;
												sendAudioInfo.Days[m].TimeSectionInfos[n].End = AudioInfo.Days[m].TimeSectionInfos[n].End;
											} else {
												if(!sendAudioInfo.Days[m].TimeSectionInfos) {
													sendAudioInfo.Days[m].TimeSectionInfos = [];

												}
												sendAudioInfo.Days[m].Num++;
												sendAudioInfo.Days[m].TimeSectionInfos.push(AudioInfo.Days[m].TimeSectionInfos[n]);
											}
										} else {
											sendAudioInfo.Days[m].TimeSectionInfos[n].Begin = "00:00:00";
											sendAudioInfo.Days[m].TimeSectionInfos[n].End = "00:00:00";
										}
									}
								}
							}
							if(sendData.Actions[i].ActID == 29) {
								sendData.Actions[i].Enabled = 1;
								var sendLightInfo = sendData.Actions[i].ActParam.LightCustomInfo;
								LightFirst = false;
								sendAudioInfo.Days.Num = 8;
								for(var m = 0; m < 7; m++) {
									var numberOfcycles = sendLightInfo.LightWeekPlanInfo.Days[m].Num < 3 ? 3 : sendLightInfo.LightWeekPlanInfo.Days[m].Num;
									var orangeNum = sendLightInfo.LightWeekPlanInfo.Days[m].Num;
									for(var n = 0; n < numberOfcycles; n++) {
										if(n < 3) {
											if(n < orangeNum) {
												sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Enabled = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Enabled;
												sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin;
												sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End;
											} else {
												if(!sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos) {
													sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos = [];

												}
												sendLightInfo.LightWeekPlanInfo.Days[m].Num++;
												sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos.push(LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n]);
											}
										} else {
											sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin = "00:00:00";
											sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End = "00:00:00";
										}
									}
								}

							}
						}
						if(AudioFirst) {
							sendData.Actions.push(configData.Actions[0]);
							sendData.Num++;
						}
						if(LightFirst) {
							sendData.Actions.push(configData.Actions[1]);
							sendData.Num++;
						}
						SendAjax(AlarmLAPI, 'put', function(code, data) {
							dsBridgeFuncSyn.dismiss();
							if(code == 0) {
								showToast(langTip["WEB_api_error_succeeded"], code);
							} else {
								showToast(langTip["WEB_api_error_operation_fails"], code);
							}
						}, sendData);
					} else {
						dsBridgeFuncSyn.dismiss();
						showToast(langTip["WEB_api_error_operation_fails"], code);
					}
				});

			}

			/*
			 * 保存IPC告警音配置
			 */
			function save() {
				dsBridgeFuncSyn.showLoading();
				SendAjax(AlarmLAPI, 'get', function(code, data) {
					if(code == 0) {
						var sendData = JSON.parse(JSON.stringify(data));
						var AudioFirst = true;
						var LightFirst = true;
						var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
						var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
						for(var i = 0; i < sendData.Num; i++) {
							if(sendData.Actions[i].ActID == 28) {
								var sendAudioInfo = sendData.Actions[i].ActParam.AudioCustomInfo;
								sendData.Actions[i].Enabled = 1;
								AudioFirst = false;
								for(var m = 0; m < 7; m++) {
									var numberOfcycles = sendAudioInfo.Days[m].Num < 3 ? 3 : sendAudioInfo.Days[m].Num;
									var orangeNum = sendAudioInfo.Days[m].Num;
									for(var n = 0; n < numberOfcycles; n++) {
										if(n < 3) {
											if(n < orangeNum) {
												sendAudioInfo.Days[m].TimeSectionInfos[n].AudioActParamInfo.AudioFileID = AudioInfo.Days[m].TimeSectionInfos[n].AudioActParamInfo.AudioFileID;
												sendAudioInfo.Days[m].TimeSectionInfos[n].Enabled = AudioInfo.Days[m].TimeSectionInfos[n].Enabled;
												sendAudioInfo.Days[m].TimeSectionInfos[n].Begin = AudioInfo.Days[m].TimeSectionInfos[n].Begin;
												sendAudioInfo.Days[m].TimeSectionInfos[n].End = AudioInfo.Days[m].TimeSectionInfos[n].End;
											} else {
												if(!sendAudioInfo.Days[m].TimeSectionInfos) {
													sendAudioInfo.Days[m].TimeSectionInfos = [];

												}
												sendAudioInfo.Days[m].Num++;
												sendAudioInfo.Days[m].TimeSectionInfos.push(AudioInfo.Days[m].TimeSectionInfos[n]);
											}
										} else {
											sendAudioInfo.Days[m].TimeSectionInfos[n].Begin = "00:00:00";
											sendAudioInfo.Days[m].TimeSectionInfos[n].End = "00:00:00";
										}
									}
								}

							}
							if(sendData.Actions[i].ActID == 29) {
								sendData.Actions[i].Enabled = 1;
								var sendLightInfo = sendData.Actions[i].ActParam.LightCustomInfo;
								LightFirst = false;
								for(var m = 0; m < 7; m++) {
									var numberOfcycles = sendLightInfo.LightWeekPlanInfo.Days[m].Num < 3 ? 3 : sendLightInfo.LightWeekPlanInfo.Days[m].Num;
									var orangeNum = sendLightInfo.LightWeekPlanInfo.Days[m].Num;
									for(var n = 0; n < numberOfcycles; n++) {
										if(n < 3) {
											if(n < orangeNum) {
												sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Enabled = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Enabled;
												sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin;
												sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End = LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End;
											} else {
												if(!sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos) {
													sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos = [];

												}
												sendLightInfo.LightWeekPlanInfo.Days[m].Num++;
												sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos.push(LightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n]);
											}
										} else {
											sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].Begin = "00:00:00";
											sendLightInfo.LightWeekPlanInfo.Days[m].TimeSectionInfos[n].End = "00:00:00";
										}
									}
								}

							}
						}
						if(AudioFirst) {
							var AudioInfo = configData.Actions[0].ActParam.AudioCustomInfo;
							for(var z = 1; z < 8; z++) {
								var DayData1 = JSON.parse(JSON.stringify(Day));
								DayData1.ID = z;
								var TimeSectionInfosData1 = JSON.parse(JSON.stringify(AudioTimeSectionInfo));
								DayData1.Num++;
								DayData1.TimeSectionInfos.push(TimeSectionInfosData1);
								AudioInfo.Days.push(DayData1);
							}
							sendData.Actions.push(configData.Actions[0]);
							sendData.Num++;
						}
						if(LightFirst) {
							var LightInfo = configData.Actions[1].ActParam.LightCustomInfo;
							for(var z = 1; z < 8; z++) {
								var DayData2 = JSON.parse(JSON.stringify(Day));
								DayData2.ID = z;
								var TimeSectionInfosData2 = JSON.parse(JSON.stringify(LightTimeSectionInfo));
								DayData2.Num++;
								DayData2.TimeSectionInfos.push(TimeSectionInfosData2);
								LightInfo.LightWeekPlanInfo.Days.push(DayData2);
							}
							sendData.Actions.push(configData.Actions[1]);
							sendData.Num++;
						}
						SendAjax(AlarmLAPI, 'put', function(code, data) {
							dsBridgeFuncSyn.dismiss();
							if(code == 0) {
								showToast(langTip["WEB_api_error_succeeded"], code);
							} else {
								showToast(langTip["WEB_api_error_operation_fails"], code);
							}
						}, sendData);
					} else {
						dsBridgeFuncSyn.dismiss();
						showToast(langTip["WEB_api_error_operation_fails"], code);
					}
				});
			}
		</script>
	</body>

</html>