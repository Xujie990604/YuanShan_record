<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<title></title>
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/iconfont.css" rel="stylesheet" />
		<link href="../css/Common.css" rel="stylesheet" />
		<!--<link href="../css/theme_normal.css" rel="stylesheet" />-->
		<style>
		.mui-table-view-radio .mui-table-view-cell.mui-selected .mui-navigate-right:after {
			content: '\e442';
		}
		
		.mui-table-view-radio .mui-table-view-cell .mui-navigate-right:after {
			font-weight: 200;
		}
		
		.mode-style {
			font-size: 16px;
			color: #333;
		}
		
		.mode-detail-style {
			font-size: 12px;
			color: rgba(51, 51, 51, 0.4);
		}
		
		.mui-table-view-radio .mui-table-view-cell {
			height: 100%;
		}
		
		.mui-table-view-radio .mui-table-view-cell .mui-navigate-right:after {
			content: '\e411';
		}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="back" class="mui-icon iconfont icon-back1"></a>
			<h1 id="title" class="mui-title" data-text="WEB_PowerConsumptionMode">&nbsp;</h1>
		</header>
		<div class="mui-content">
			<ul id="modeList" class="mui-table-view mui-table-view-radio mui-hidden">
				<!--<li id="autoChange" class="mui-table-view-cell mui-hidden" data-switch="2">
					<a class="mui-navigate-right">
						<div class="mode-style ">
							自动模式
						</div>
						<div class="mode-detail-style">
							&nbsp;
						</div>
					</a>
				</li>
				<li id="ultraPowerSavingMode" class="mui-table-view-cell mui-hidden" data-switch="1" data-mode="3">
					<a class="mui-navigate-right">
						<div class="mode-style ">
							超级省电模式
						</div>
						<div class="mode-detail-style">
							&nbsp;
						</div>
					</a>
				</li>
				<li id="powerSavingMode" class="mui-table-view-cell mui-hidden" data-switch="1" data-mode="2">
					<a class="mui-navigate-right">
						<div class="mode-style ">
							省电模式
						</div>
						<div class="mode-detail-style">
							&nbsp;
						</div>
					</a>
				</li>-->
				<li id="standardMode" class="mui-table-view-cell mui-hidden" data-switch="1" data-mode="1">
					<div class="mode-style mui-navigate-right" data-text="WEB_PowerNormal">
						&nbsp;
					</div>
					<div class="mode-detail-style" data-text="WEB_PowerNormalTip">
						&nbsp;
					</div>
				</li>
				<li id="sleepMode" class="mui-table-view-cell mui-hidden" data-switch="1" data-mode="4">
					<div class="mode-style mui-navigate-right" data-text="WEB_PowerSleep">
						&nbsp;
					</div>
					<div class="mode-detail-style" data-text="WEB_PowerSleepTip">
						&nbsp;
					</div>
				</li>
			</ul>
		</div>

		<script src="../js/dsbridge.min.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/libs/md5.js"></script>
		<script src="../js/libs/jquery-3.4.1.min.js"></script>
		<script src="../js/libs/sha2.js"></script>
		<script src="../js/resource.js"></script>
		<script src="../js/Utils.js"></script>
		<script src="../js/mui.js"></script>
		<script src="../js/immersed.js"></script>
		<script src="../js/JavaScriptEZAPP.js"></script>
		<script src="../js/customSetting.js"></script>
		<script src="../js/loadCss.js"></script>
		    <script id="langScript"></script>
		<script>
			var isShowNoFunction; //无功能占位图
			var PowerModeCapabilities; //
			var powerModeInfo; //模式信息
			checkType(localStorage.AppType); //加载特定样式
			mui.init();
			var typeLan = initLang();
			langTip = typeLan.lang;
			initPage();
			initData();
			initEvent();

			function initPage() {

			}

			function initData() {
				initPowerModeCapabilities();
			}

			function initEvent() {
				var list = document.querySelector('.mui-table-view.mui-table-view-radio');
				list.addEventListener('selected', function(e) {
					var sendData;
					if(e.detail.el.getAttribute("data-switch") == 2) {
						sendData = {
							ModeSwitchType: 2
						}
					} else if(e.detail.el.getAttribute("data-switch") == 1) {
						sendData = {
							ModeSwitchType: 1,
							Mode: Number(e.detail.el.getAttribute("data-mode"))
						}
					}
					console.log(sendData);
					dsBridgeFuncSyn.showLoading();
					SendAjax(LAPI.PowerMode, 'put', function(code, data) {
						dsBridgeFuncSyn.dismiss();
						if(code == 0) {
							powerModeInfo = sendData;
						} else {
							showToast(langTip["WEB_loadFailed"], code);
							setSelectMode(powerModeInfo);
						}
					}, sendData);
				});
			}
			/** STEP1
			 * 初始化系统能力 判断是否支持功耗模式切换
			 */
			function initPowerModeCapabilities() {
				isShowNoFunction = true;
				SendAjax(LAPI.SystemCapabilities, 'get', function(code, data) {
					appLog("Web --- SystemCapabilities : " + JSON.stringify(data));
					if(code == 0) {
						PowerModeCapabilities = data.PowerModeCapabilities;
						//						PowerModeCapabilities = {
						//							PowerModeSwitchNum: 3,
						//							PowerModeSwitchList: [1, 2],
						//							SupportPowerModeNum: 3,
						//							SupportPowerModeList: [1, 2, 3]
						//						};
						if(PowerModeCapabilities && PowerModeCapabilities.PowerModeSwitchNum > 0) {
//							//支持自动
//							if(PowerModeCapabilities.PowerModeSwitchList.indexOf(2) > -1) {
//								$("#autoChange").removeClass("mui-hidden");
//								isShowNoFunction = false;
//							}
							//支持手动
							if(PowerModeCapabilities.PowerModeSwitchList.indexOf(1) > -1 && PowerModeCapabilities.SupportPowerModeNum > 0) {
								//支持标准模式
								if(PowerModeCapabilities.SupportPowerModeList.indexOf(1) > -1) {
									$("#standardMode").removeClass("mui-hidden");
									isShowNoFunction = false;
								}
//								//支持低功耗模式
//								if(PowerModeCapabilities.SupportPowerModeList.indexOf(2) > -1) {
//									$("#powerSavingMode").removeClass("mui-hidden");
//									isShowNoFunction = false;
//								}
//								//支持超低功耗模式
//								if(PowerModeCapabilities.SupportPowerModeList.indexOf(3) > -1) {
//									$("#ultraPowerSavingMode").removeClass("mui-hidden");
//									isShowNoFunction = false;
//								}
								//支持休眠模式
								if(PowerModeCapabilities.SupportPowerModeList.indexOf(4) > -1) {
									$("#sleepMode").removeClass("mui-hidden");
									isShowNoFunction = false;
								}
							}
						}
						if(isShowNoFunction) {
							addBitmap(1, langTip["WEB_unSupported"]);
							dsBridgeFuncSyn.dismiss();
						} else {
							initPowerModeInfo();
						}
					} else if(code == 4 || code == 8 || code == 1006) {
						addBitmap(1, langTip["WEB_unSupported"]);
						dsBridgeFuncSyn.dismiss();
					} else {
						showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
						addBitmap(0);
						dsBridgeFuncSyn.dismiss();
					}
				})
			}
			/** STEP2
			 * 初始化模式
			 */
			function initPowerModeInfo() {
				SendAjax(LAPI.PowerMode, 'get', function(code, data) {
					if(code == 0) {
						powerModeInfo = deepCopy(data);
						//						powerModeInfo = {
						//							ModeSwitchType: 1,
						//							Mode: 1
						//						};
						setSelectMode(powerModeInfo);
						$("#modeList").removeClass("mui-hidden");
						dsBridgeFuncSyn.dismiss();
					} else if(code == 4 || code == 8 || code == 1006) {
						addBitmap(1, langTip["WEB_unSupported"]);
						dsBridgeFuncSyn.dismiss();
					} else {
						//TODO:加载失败显示加载失败占位图
						addBitmap(0);
						showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
						dsBridgeFuncSyn.dismiss();
					}
				});

			}
			/*
			 *
			 * 
			 * */
			function setSelectMode(powerModeInfoObj) {
				$("#modeList li").removeClass("mui-selected");
				if(powerModeInfoObj.ModeSwitchType == 2) {
					$("#autoChange").addClass("mui-selected");
				} else if(powerModeInfoObj.ModeSwitchType == 1) {
					switch(powerModeInfoObj.Mode) {
						case 1:
							$("#standardMode").addClass("mui-selected");
							break;
						case 2:
							$("#powerSavingMode").addClass("mui-selected");
							break;
						case 3:
							$("#ultraPowerSavingMode").addClass("mui-selected");
							break;
						case 4:
							$("#sleepMode").addClass("mui-selected");
							break;
						default:
							break;
					}
				}
			}
		</script>
	</body>

</html>