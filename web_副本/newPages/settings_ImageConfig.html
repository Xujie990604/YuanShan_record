<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title></title>
  <link href="../css/mui.css" rel="stylesheet" />
  <link href="../css/iconfont.css" rel="stylesheet" />
  <link href="../css/Common.css" rel="stylesheet" />
  <link href="../css/theme_normal.css" rel="stylesheet" />
  <style>
    #baseUl .mui-table-view-radio .mui-table-view-cell.mui-selected .mui-navigate-right:after {
      content: '\e442';
    }

    #baseUl .mui-table-view-radio .mui-table-view-cell .mui-navigate-right:after {
      font-weight: 200;
    }

    #baseUl .mui-table-view {
      overflow: hidden;
    }

    .mode-style {
      font-size: 16px;
      color: #333;
    }

    .mode-detail-style {
      font-size: 14px;
      color: rgba(51, 51, 51, 0.4);
    }

    #baseUl .mui-table-view-radio .mui-table-view-cell {
      height: 100%;
    }

    #baseUl .mui-table-view-radio .mui-table-view-cell .mui-navigate-right:after {
      content: '\e411';
    }

    /* 昼夜模式 title 样式 */
    .day-night-mode-title {
      font-size: 14px;
      padding-top: 5px;
      padding-bottom: 8px;
      padding-left: 10px;
      color: #000000;
      opacity: 0.4;
    }

    #nightTimingMode::after {
      height: 1px;
    }
  </style>
</head>

<body>
  <header class="mui-bar mui-bar-nav">
    <a id="back" class="mui-icon iconfont icon-back1"></a>
    <h1 id="title" class="mui-title" data-text="WEB_image_setting">&nbsp;</h1>
  </header>
  <div class="mui-content">
    <div id="baseUl" class="mui-hidden">
      <!--宽动态-->
      <ul id='dynamic-content' class="mui-table-view mui-hidden">
        <li id="setWideDynamic" class="mui-table-view-cell">
          <span data-text="WEB_device_manager_WideDynamic_setting">&nbsp;</span>
          <div id="setWideDynamicSwitch" class="mui-switch mui-switch-mini">
            <div class="mui-switch-handle" id="setWideDynamicCircle"></div>
          </div>
          <div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
        </li>
      </ul>

      <!-- 智能补光 -->
      <ul id="Image" class="mui-table-view ui-siwtchlist mui-hidden">
        <!-- 智能补光使能按钮 -->
        <li id="setImage" class="mui-table-view-cell">
          <span data-text="WEB_Intelligent_light_supply" class="mainStyle">&nbsp;</span>
          <div id="setImageSwitch" class="mui-switch mui-switch-mini">
            <div class="mui-switch-handle" id="setImageCircle"></div>
          </div>
          <div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
        </li>
        <div id="LightModeList" class="mui-table-view-radio mui-hidden">
          <!-- 白光模式 -->
          <li id="whiteMode" class="mui-table-view-cell mui-hidden" data-switch="1">
            <div class="mode-style mui-navigate-right" data-text="WEB_white_mode">
              &nbsp;
            </div>
            <div class="mode-detail-style" data-text="WEB_whiteLightMode">
              &nbsp;
            </div>
          </li>
          <!-- 红外模式 -->
          <li id="redMode" class="mui-table-view-cell mui-hidden" data-switch="2">
            <div class="mode-style mui-navigate-right" data-text="WEB_infra_red_mode">
              &nbsp;
            </div>
            <div class="mode-detail-style" data-text="WEB_infraredMode">
              &nbsp;
            </div>
          </li>
          <!-- 智能双光 -->
          <li id="doubleMode" class="mui-table-view-cell mui-hidden" data-switch="6">
            <div class="mode-style mui-navigate-right" data-text="WEB_Intelligent_double_light">
              &nbsp;
            </div>
            <div class="mode-detail-style" data-text="WEB_dualLightMode">
              &nbsp;
            </div>
          </li>
          <li id="smartWhite" class="mui-table-view-cell mui-hidden" data-switch="8">
						<div class="mode-style mui-navigate-right" data-text="WEB_Intelligent_white_light">
							&nbsp;
						</div>
						<div class="mode-detail-style" data-text="WEB_IntelligentWhiteLightMode">
							&nbsp;
						</div>
					</li>
        </div>
      </ul>

      <!--昼夜模式设置-->
      <ul id="dayNight" class="mui-table-view mui-hidden">
        <li id="setDayNight" class="mui-table-view-cell">
          <span data-text="WEB_dayNightMode" class="mainStyle">&nbsp;</span>
        </li>
        <div class="mui-table-view-radio" id="DayNightModeList">
          <!-- 自动 -->
          <li id="autoMode" class="mui-table-view-cell mui-hidden" data-switch="0">
            <div class="mode-style mui-navigate-right" data-text="WEB_auto">
              &nbsp;
            </div>
          </li>
          <!-- 白天 -->
          <li id="dayMode" class="mui-table-view-cell mui-hidden" data-switch="1">
            <div class="mode-style mui-navigate-right" data-text="WEB_dayTime">
              &nbsp;
            </div>
          </li>
          <!-- 夜晚 -->
          <li id="nightMode" class="mui-table-view-cell mui-hidden" data-switch="2">
            <div class="mode-style mui-navigate-right" data-text="WEB_nightTime">
              &nbsp;
            </div>
          </li>
          <!-- 定时夜晚 -->
          <li id="nightTimingMode" class="mui-table-view-cell mui-hidden" data-switch="4">
            <div class="mode-style mui-navigate-right" data-text="WEB_nightTiming">
              &nbsp;
            </div>
          </li>
        </div>
        <li id="nightTime" class="mui-table-view-cell StarTimeItem mui-hidden">
          <a id="StarTimeArea" class="mui-navigate-right">&nbsp;
            <span data-text="WEB_start_end_time" class="mainStyle padding-left-15">&nbsp;</span>
            <span id="TimeStepVal" class="mui-badge "></span>
          </a>
          <div class="loadFailed mui-hidden" data-text="WEB_loadFailed">&nbsp;</div>
        </li>
      </ul>
      <script src="../js/dsbridge.min.js"></script>
      <script src="../js/common.js"></script>
      <script src="../js/JavaScriptEZAPP.js"></script>
      <script src="../js/libs/md5.js"></script>
      <script src="../js/libs/jquery-3.4.1.min.js"></script>
      <script src="../js/libs/sha2.js"></script>
      <script src="../js/resource.js"></script>
      <script src="../js/Utils.js"></script>
      <script src="../js/mui.js"></script>
      <script src="../js/immersed.js"></script>
      <script src="../js/loadCss.js "></script>
      <script id="langScript"></script>
      <script>
        checkType(localStorage.AppType); //加载特定样式
        var isShowNoFunction; // 没功能占位图展示
        var capabilityDataObj;

        //宽动态配置
        var setWideDynamicConfirm = true; //宽动态开关状态变化时是否调接口提交
        var WideDynamicServiceData;       // 保存的宽动态有关信息
        var WideDynamicCheck;

        // 智能补光
        var setImageConfirm = true;  //补灯光模开关状态变化时是否调接口提交
        var setImageServiceData; //补灯光模使能服务端数据
        var setImageCapabilities;   // 保存的图像配置能力集对象
        var setImageCheck; // 图像设置开关是否开启
        var LightModeVal; //补灯光模式取值
 
        // 昼夜模式设置
        var dayNightModeChecked; //选中的昼夜模式
        var imageServiceData; // 图像配置服务端数据
        var LightModeChecked;
        var date = { //初始化起止时间
          startHour: 0,
          startMin: 0,
          startSec: 0,
          endHour: 0,
          endMin: 0,
          endSec: 0
        };

        var isSupportWDR = false;
        var isSupportInteligentLight = false;
        var isSupportDayLight = false;   // 支持灯光能力使能
        mui.init();
        var typeLan = initLang();
        langTip = typeLan.lang;

        initData();
        initEvent();

        function initData() {
          // 1. 获取设备的能力集
          getImageCapabilities();
        }

        // 获取设备的能力集
        function getImageCapabilities() {
          isShowNoFunction = true;
          SendAjax(LAPI.ImageCapabilities, 'get', function (code, data) {
            if (code == 0) {
              setImageCapabilities = deepCopy(data);
                // 昼夜模式
                if (setImageCapabilities.Exposure) {
                  if (setImageCapabilities.Exposure.DayNight && setImageCapabilities.Exposure.DayNight.DayNightModeNum != 0 && setImageCapabilities.Exposure.DayNight.SupportDayNightCfg == 1) {
                    isShowNoFunction = false;
                    // 支持灯光能力使能
                    isSupportDayLight = true;
                  }
                }
              // 宽动态
              if (setImageCapabilities.Exposure) {
                if (setImageCapabilities.Exposure.WideDynamic && setImageCapabilities.Exposure.WideDynamic.SupportWideDynamicCfg == 1) {
                  isShowNoFunction = false;
                  // 支持宽动态能力使能
                  isSupportWDR = true;
                }
              }
              // 智能补光
              if (setImageCapabilities.LampCtrl) {
                if (setImageCapabilities.LampCtrl.LampNum != 0) {
                  isShowNoFunction = false;
                  // 支持智能补光能力使能
                  isSupportInteligentLight = true;
                }
              }

              //初始化页面逻辑增加
              initImageInterface();

            } else if (code == 4 || code == 8) {
              dsBridgeFuncSyn.dismiss();
              addBitmap(1, langTip["WEB_unSupported"]);
            } else {
              dsBridgeFuncSyn.dismiss();
              //TODO:加载失败显示加载失败占位图
              addBitmap(0);
              showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
            }
          })
        }

        function initImageInterface() {
          // 支持宽动态
          if (isSupportWDR) {
            initWideDynamicData();
          } else {
            //不支持宽动态，支持智能补光
            if (isSupportInteligentLight) {
              initsetImage();
            } else {
              if (isSupportDayLight) {
                initDayNight();
              } else {
                dsBridgeFuncSyn.dismiss();
                $("#baseUl").removeClass("mui-hidden");
              }
            }
          }

          if (isShowNoFunction) {
            //TODO:无功能占位图
            dsBridgeFuncSyn.dismiss();
            addBitmap(1, langTip["WEB_noConfigAvailable"]);
          }
        }

        function initEvent() {
          //智能补光
          document.getElementById("LightModeList").addEventListener('selected', function (e) {
            var sendData = deepCopy(setImageServiceData);
            sendData.Type = Number(e.detail.el.getAttribute("data-switch"));
            dsBridgeFuncSyn.showLoading();
            SendAjax(LAPI.ImageLampCtrl, 'put', function (code, data) {
              dsBridgeFuncSyn.dismiss();
              if (code == 0) {
                setImageServiceData = deepCopy(sendData);
                showToast(langTip["WEB_api_error_succeeded"]);
              } else {
                setMode(setImageServiceData.Type);
                showToast(langTip["WEB_toast_modify_favoritesname_failed"] + "(" + code + ")", code);
              }
            }, sendData);
          });

          // 昼夜模式
          document.getElementById("DayNightModeList").addEventListener('selected', function (e) {
            var newvlalue = Number(e.detail.el.getAttribute("data-switch"));
            DayNightModeOk(newvlalue);
          });
          document.getElementById('nightTime').addEventListener('tap', getTimeFrame);
        }

        /*
         * 发请求获取宽动态配置数据初始化
         */
        function initWideDynamicData() {
          SendAjax(LAPI.WideDynamic, 'get', function (code, data) {
            if (code == 0) {
              WideDynamicServiceData = deepCopy(data);
              WideDynamicCheck = data.WideDynamic.Mode; // 0：关闭，1/2：开启
              if (WideDynamicCheck == 2) {
                WideDynamicCheck == 1;
              }
              document.getElementById("setWideDynamicSwitch").style.zIndex = 20;
              document.getElementById("setWideDynamicSwitch").style.visibility = "visible";
              // 根据接口字段，来初始化宽动态开关状态
              setWideDynamicConfirm = false;
              setSwitchStatus("setWideDynamicSwitch", WideDynamicCheck)
              setWideDynamicConfirm = true;
              var setWideDynamicActive = document.getElementById("setWideDynamicSwitch").classList.contains("mui-active")
              if (setWideDynamicActive) {
                document.getElementById("setWideDynamicCircle").style.transform = 'translate(16px, 0px)';
              }

              $("#dynamic-content").removeClass("mui-hidden");
              //不支持宽动态，支持智能补光
              if (isSupportInteligentLight) {
                initsetImage();
              } else {
                if (isSupportDayLight) {
                  initDayNight();
                } else {
                  dsBridgeFuncSyn.dismiss();
                  $("#baseUl").removeClass("mui-hidden");
                }
              }
            } else {
              //数据获取失败的处理
              addBitmap(0);
              showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
              dsBridgeFuncSyn.dismiss();
            }
          })
        }
        /*
         *  监听宽动态开关
         */
        document.getElementById("setWideDynamicSwitch").addEventListener('toggle', function (event) {
          if (event.detail.isActive && setWideDynamicConfirm) {
            var sendDataON = deepCopy(WideDynamicServiceData);
            sendDataON.WideDynamic.Mode = 1;
            dsBridgeFuncSyn.showLoading();
            SendAjax(LAPI.WideDynamic, 'put', function (code, data, responseCode) {
              dsBridgeFuncSyn.dismiss();
              if (code == 0) {

              } else {
								setWideDynamicConfirm = false
                if(responseCode == 7) {
                  showToast(langTip["WEB_limited"]);
                } else {
                  showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
                }
								setTimeout(function() {
									mui("#setWideDynamicSwitch").switch().toggle()
								}, 200)
              }
            }, sendDataON)
          } else if (!event.detail.isActive && setWideDynamicConfirm) {
            var sendDataOFF = deepCopy(WideDynamicServiceData);
            sendDataOFF.WideDynamic.Mode = 0;
            dsBridgeFuncSyn.showLoading();
            SendAjax(LAPI.WideDynamic, 'put', function (code, data) {
              dsBridgeFuncSyn.dismiss();
              if (code == 0) {

              } else {
                setWideDynamicConfirm = false;
                showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
                setTimeout(function () {
                  mui("#setWideDynamicSwitch").switch().toggle();
                }, 200)
              }
            }, sendDataOFF)
          } else {
            setWideDynamicConfirm = true;
          }
        })

        /**
         * 图像设置使能
         */
        function initsetImage() {
          setImageData(setImageCapabilities.LampCtrl.LampInfos);
        }

        /**
         * 根据接口数据，将智能补光能力支持的模式在界面中显示
         * @param {Array} data 支持的模式
         */
        function getLightModeList(data) {
          for (var i = 0; i < data.length; i++) {
            if (data[i].LampType == 1 || data[i].LampType == 2 || data[i].LampType == 6 || data[i].LampType == 8) {
              if (data[i].LampType == 1) {
                $("#whiteMode").removeClass("mui-hidden");
              } else if (data[i].LampType == 2) {
                $("#redMode").removeClass("mui-hidden");
              } else if (data[i].LampType == 6) {
                $("#doubleMode").removeClass("mui-hidden");
              } else if (data[i].LampType == 8) {
                $("#smartWhite").removeClass("mui-hidden");
              }
            }
          }
        }

        /**
         * 发请求获取图像设置使能数据初始化
         * @param {Object} list
         */
        function setImageData(list) {
          SendAjax(LAPI.ImageLampCtrl, 'get', function (code, data) {
            if (code == 0) {
              getLightModeList(list);
              setImageServiceData = deepCopy(data);
              setImageCheck = data.Enabled; // 0：关闭，1：开启
              document.getElementById("setImageSwitch").style.zIndex = 20;
              document.getElementById("setImageSwitch").style.visibility = "visible";
              // 根据接口字段，来初始化智能补光开关状态
              setImageConfirm = false;
              setSwitchStatus("setImageSwitch", setImageCheck);
              setImageConfirm = true;
              LightModeVal = setImageServiceData.Type;
              // 根据接口字段，来初始化智能补光模式
              setMode(LightModeVal);
              if (setImageCheck == 1) {
                $("#LightModeList").removeClass("mui-hidden");
              }
              $("#Image").removeClass("mui-hidden");

              if (isSupportDayLight) {
                initDayNight();
              } else {
                dsBridgeFuncSyn.dismiss();
                $("#baseUl").removeClass("mui-hidden");
              }

            } else {
              //数据获取失败的处理
              addBitmap(0);
              showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
              dsBridgeFuncSyn.dismiss();
            }
          });
        }
        /*
         * 监听图像设置开关
         */
        document.getElementById("setImageSwitch").addEventListener("toggle", function (event) {
          if (event.detail.isActive && setImageConfirm) {
            var sendDataON = deepCopy(setImageServiceData);
            sendDataON.Enabled = 1; // 0：图像设置关闭，1：图像设置开启
            dsBridgeFuncSyn.showLoading();
            SendAjax(LAPI.ImageLampCtrl, 'put', function (code, data) {
              dsBridgeFuncSyn.dismiss();
              if (code == 0) {
                $("#LightModeList").removeClass("mui-hidden");
                setImageServiceData.Enabled = 1;
                showToast(langTip["WEB_api_error_succeeded"]);
              } else {
                setImageConfirm = false;
                showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
                setTimeout(function () {
                  mui("#setImageSwitch").switch().toggle();
                }, 200);
              }
            }, sendDataON);
          } else if (!event.detail.isActive && setImageConfirm) {
            $("#LightModeList").addClass("mui-hidden");
            var sendDataOFF = deepCopy(setImageServiceData);
            sendDataOFF.Enabled = 0; // 0：图像设置关闭，1：图像设置开启
            dsBridgeFuncSyn.showLoading();
            SendAjax(LAPI.ImageLampCtrl, 'put', function (code, data) {
              dsBridgeFuncSyn.dismiss();
              if (code == 0) {
                setImageServiceData.Enabled = 0;
                showToast(langTip["WEB_api_error_succeeded"]);
              } else {
                setImageConfirm = false;
                showToast(langTip["WEB_api_error_operation_fails"] + "(" + code + ")", code);
                setTimeout(function () {
                  mui("#setImageSwitch").switch().toggle();
                  $("#LightModeList").removeClass("mui-hidden");
                }, 300);
              }
            }, sendDataOFF);
          } else {
            setImageConfirm = true;
          };
        });

        // 智能补光模式切换
        function setMode(LightModeVal) {
          $("#LightModeList li").removeClass("mui-selected");
          if (LightModeVal == 1) {
            $("#whiteMode").addClass("mui-selected");
          } else if (LightModeVal == 2) {
            $("#redMode").addClass("mui-selected");
          } else if (LightModeVal == 6) {
            $("#doubleMode").addClass("mui-selected");
          } else if (LightModeVal == 8) {
					  $("#smartWhite").addClass("mui-selected");
				  }
        }

        // 初始化昼夜模式
        function initDayNight() {
          // 1. 根据接口字段，渲染昼夜模式列表
          getDayNightModeList(setImageCapabilities.Exposure.DayNight.DayNightModeList);
          // 2. 发接口，请求昼夜模式数据
          setDayNightData();
        }

        // 根据接口数据来渲染昼夜模式列表是否显示
        function getDayNightModeList(data) {
          for (var i = 0; i < data.length; i++) {
            if (data[i] == 1 || data[i] == 2 || data[i] == 0 || data[i] == 4) {
              if (data[i] == 0) {
                $("#autoMode").removeClass("mui-hidden");
              } else if (data[i] == 1) {
                $("#dayMode").removeClass("mui-hidden");
              } else if (data[i] == 2) {
                $("#nightMode").removeClass("mui-hidden");
              } else if (data[i] == 4) {
                $("#nightTimingMode").removeClass("mui-hidden");
              }
            }
          }
        }

        /*
         * 发请求获取昼夜设置数据初始化
         */
        function setDayNightData() {
          SendAjax(LAPI.DayNightInfo, 'get', function (code, data) {
            if (code == 0) {
              imageServiceData = deepCopy(data);
              var dayNightModeText = '';
              // 获取当前昼夜模式的值
              dayNightModeChecked = imageServiceData.DayNight.Mode;
              // 初始化当前昼夜模式的值
              setDayMode(dayNightModeChecked);
              if (dayNightModeChecked == 4) {
                //显示定时夜晚的起止时间配置选项
                var statrTime = imageServiceData.DayNight.Start;
                var endTime = imageServiceData.DayNight.End;
                document.getElementById('nightTime').classList.remove('mui-hidden');
                document.getElementById('TimeStepVal').innerText = statrTime + "-" + endTime;
              }
              $("#dayNight").removeClass("mui-hidden");
              dsBridgeFuncSyn.dismiss();
              $("#baseUl").removeClass("mui-hidden");
            } else {
              //数据获取失败的处理
              addBitmap(0);
              showToast(langTip["WEB_loadFailed"] + "(" + code + ")", code);
              dsBridgeFuncSyn.dismiss();
            }
          });
        }

        // 给昼夜模式的被选中的值加上选中样式
        function setDayMode(LightModeVal) {
          $("#DayNightModeList li").removeClass("mui-selected");
          if (LightModeVal == 0) {
            $("#autoMode").addClass("mui-selected");
          } else if (LightModeVal == 1) {
            $("#dayMode").addClass("mui-selected");
          } else if (LightModeVal == 2) {
            $("#nightMode").addClass("mui-selected");
          } else if (LightModeVal == 4) {
            $("#nightTimingMode").addClass("mui-selected");
          }
        }
        /*
         * 昼夜模式设置
         */

        function DayNightModeOk(dayNightModeChecked_new) {
          var sendData = deepCopy(imageServiceData);
          sendData.DayNight.Mode = dayNightModeChecked_new;
          dsBridgeFuncSyn.showLoading();
          SendAjax(LAPI.DayNightInfo, 'put', function (code, data) {
            dsBridgeFuncSyn.dismiss();
            if (code == 0) {
              if (dayNightModeChecked_new == 4) {
                $("#nightTime").removeClass("mui-hidden");
                var statrTime = imageServiceData.DayNight.Start;
                var endTime = imageServiceData.DayNight.End;
                document.getElementById('nightTime').classList.remove('mui-hidden');
                document.getElementById('TimeStepVal').innerText = statrTime + "-" + endTime;
              } else {
                $("#nightTime").addClass("mui-hidden");
              }
              imageServiceData = deepCopy(sendData);
              dayNightModeChecked = dayNightModeChecked_new;
            } else {
              setDayMode(dayNightModeChecked);
              showToast(langTip["WEB_toast_modify_favoritesname_failed"] + "(" + code + ")", code);
            }
            mui('#setDayNightMode').popover('toggle');
          }, sendData);
        }

        /**
         * 起止时间设置
         */
        function getTimeFrame() {
          var v = document.getElementById('nightTime');
          var startType = v.children["StarTimeArea"].children["TimeStepVal"].innerText.split("-")[0];
          var endType = v.children["StarTimeArea"].children["TimeStepVal"].innerText.split("-")[1];
          date = transterTime(startType, endType);
          if (date.startHour == "24" && date.startMin == "00" && date.startSec == "00" && //开始时间和结束时间为24:00:00时，改为00:00:00
            date.endHour == "24" && date.endMin == "00" && date.endSec == "00") {
            date = {
              startHour: 0,
              startMin: 0,
              startSec: 0,
              endHour: 0,
              endMin: 0,
              endSec: 0
            }
          }
          setBrageTime(date);
        }

        function setBrageTime(date, dayNightMode) {
          //昼夜模式对起止时间不做校验
          //TODO：调用原生侧时间选择器控件
          dsBridgeFuncAsyn.showDate("hdate_ex", JSON.stringify(date), function (result) {
            var result = JSON.parse(result);
            if (result.statusCode == "1") return;
            var resultObj = JSON.parse(result.param);
            var begin = add0(resultObj.startHour) + ":" + add0(resultObj.startMin) + ":" + add0(resultObj.startSec);
            var end = add0(resultObj.endHour) + ":" + add0(resultObj.endMin) + ":" + add0(resultObj.endSec);
            var sendData = deepCopy(imageServiceData);
            var DayArr = sendData.DayNight;
            DayArr.Mode = 4;
            DayArr.Start = begin;
            DayArr.End = end;
            dsBridgeFuncSyn.showLoading();
            SendAjax(LAPI.DayNightInfo, 'put', function (code, data) {
              dsBridgeFuncSyn.dismiss();
              if (code == 0) {
                //赋值给setDayNightServiceData并更新页面
                document.getElementById('nightTime').classList.remove('mui-hidden');
                var nightTime = document.getElementById('nightTime');
                nightTime.children["StarTimeArea"].children["TimeStepVal"].innerText = begin + "-" + end;
                imageServiceData = deepCopy(sendData);
                dayNightModeChecked = 4;
                //配置成功 知会原生侧
                //TODO
                dsBridgeFuncSyn.alreadySetTimeCfg();
              } else {
                showToast(langTip["WEB_toast_modify_favoritesname_failed"] + "(" + code + ")", code);
              }
            }, sendData);
          });
        }

        /**
         * 时间格式补0
         * @param {Object} num
         */
        function add0(num) {
          var str = "";
          if (num < 10) {
            str = str + "0" + num;
          } else {
            str = str + num;
          }
          return str;
        }

        function transterTime(startTime, endTime) { //时间赋值
          var start = startTime.split(":").map(function (v) {
            return Number(v)
          })
          var end = endTime.split(":").map(function (v) {
            return Number(v)
          })
          date = {
            startHour: start[0],
            startMin: start[1],
            startSec: start[2],
            endHour: end[0],
            endMin: end[1],
            endSec: end[2]
          }
          return date
        }
      </script>
</body>

</html>