# IP协议

## 特点

* 无状态

所有 IP 数据报的发送，传输都是相对独立的，没有上下文的关系。

* 无连接

通信双方都不会长久的保留对方的任何信息，每个数据报都是独立的进行路由选择，可能选择不同的路线。
每次发送 IP 数据的时候都要明确指出对方的 ip 地址。

* 不可靠

不保证 IP 数据报能够准确到达接收端

## 路由选择

### 路由匹配

1. 直接匹配，查找路由表中是否由与目标 IP 地址完全匹配的主机 IP 地址，找到则匹配成功，没有的话转2；
2. 查找是否有与目标 IP 地址具有相同网络ID的 IP 地址，找到则匹配成功，没有的话转3；
3. 查看是否有默认网关，有则转发给它，没有的话，路由查找失败，由 ICMP 返回错误信息。

## MAC地址和内网地址

### 二层转发和三层转发

* 二层转发，同一子网内部，所有的设备处于同一个广播域，数据是基于MAC进行转发的
* 三层转发，跨子网时才会需要路由功能和路由器。转发是基于目的地的ip地址进行寻址

### MAC地址

* 媒体访问控制地址 (Media Access Control Address)，也称为局域网地址，以太网地址或物理地址它是一个用来确认网上设备位置的地址
* MAC地址是和网卡配对的，一个网卡就有一个MAC地址。MAC地址对应的是数据链路层。
* ARP (Address Resolution Protocol) 是一种用来解析地址的协议，它可以根据 IP 地址反查出对应的 MAC 地址。
* MAC地址一般来说是不可变的，在设备生产时就被烙上了唯一的标识。
* 你中午在公司点了份外卖，收货地址一定是写公司的地址；晚上回到家，再点外卖时就得把地址写成家 (IP 是动态的)。但无论在哪儿点外卖，订单上的姓名和手机号一定是你自己的 (MAC 地址)。中午外卖小哥把午餐送到公司门口，但收外卖的人肯定不止你一个 (多台设备在同一个 broadcast 网络里)，因此他会通过手机号和姓名来找到你。

### ip地址

* ip地址是可变的。ip地址对应的是网络层。
* 而IP是分层的，这和我们常用的通讯地址一致，类似于 中国/北京/海淀/后场村路/xx楼/xx号。负责整个中国的设备只要知道北京在哪，找到北京之后，负责北京的设备只要海淀在哪，负责海淀的设备只要知道后场村在哪，这样逐级查找。每个设备需要存储的信息较少。
* MAC地址具有扁平结构，无论到哪里都不会变化，比如一台智能手机无论它到哪里，它的MAC地址不会改变。而IP地址具有层次结构，当主机移动时，主机的IP地址随着连接到的网络的改变而改变，
* IP地址：分配每个设备的IP地址，使设备位于网络上。
* 公网ip地址是由运营商进行分配的IP地址。是独一无二的。
* 内网(局域网)ip是由交换机或者是路由器分配的。内网的计算机可以向公网发送连接请求，但是公网无法向内网发送连接请求。
* 百度搜索ip出来的是公网ip，CMD中显示的是内网ip
