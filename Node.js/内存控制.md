# 内存控制

- process.memoryUsage() 用于查看 V8 中的堆内存使用情况
- V8 对于内存的限制，因为能使用的内存越大，进行单次内存回收的时间就越长(1.5G 内存的单次回收已经达到了 50ms)
- 查看垃圾回收日志的方式主要是在启动时添加 `--trace_gc` 参数
- 通过在 Node 启动时使用 `--prof` 参数，可以得到 V8 执行时的性能分析数据，其中包含了垃圾回收执行时占用的时间
- os 模块中的 totalmem( )和 freemem() 这两个方法用于查看操作系统的内存使用情况，它们分别返回系统的总内存和闲置内存，以字节为单位
- Buffer 对象不同于其他对象，它不经过 V8 的内存分配机制。所以不会有堆内存大小的限制

## 注意要点

1. 全局变量不会被回收
2. 闭包中的变量不会被自动回收
3. 慎重把内存当做缓存来使用(不要在进程内缓存数据，因为进程内数据无法和其他进程共用，在进程外进行缓存)
4. 队列消费不及时(如果请求激增，数据库的读写操作太慢，导致队列中的事件无法被及时处理，导致事件一直占用内存)
